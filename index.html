<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Houston County Eviction Filing System | Georgia Magistrate Court</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        :root {
            --houston-blue: #003366;
            --houston-red: #b22234;
            --houston-gold: #f0b323;
            --georgia-blue: #0f2044;
            --georgia-red: #ae1a1f;
            --light-gray: #f8f9fa;
            --dark-gray: #343a40;
            --border-radius: 8px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --success-green: #28a745;
            --warning-orange: #fd7e14;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Open Sans', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f7fa;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header Styles */
        .header {
            background: linear-gradient(to right, var(--houston-blue), var(--georgia-blue));
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo {
            width: 70px;
            height: 70px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: var(--houston-blue);
            border: 3px solid var(--houston-gold);
        }
        
        .logo-text h1 {
            font-family: 'Merriweather', serif;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .logo-text p {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .contact-info {
            text-align: right;
        }
        
        .contact-info p {
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .contact-info i {
            margin-right: 8px;
            color: var(--houston-gold);
        }
        
        .navigation {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius);
            padding: 12px 20px;
            margin-top: 10px;
        }
        
        .nav-links {
            display: flex;
            list-style: none;
            gap: 30px;
        }
        
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 600;
            font-size: 16px;
            transition: color 0.3s;
        }
        
        .nav-links a:hover {
            color: var(--houston-gold);
        }
        
        .nav-links a i {
            margin-right: 8px;
        }
        
        /* Hero Section */
        .hero {
            padding: 60px 0;
            text-align: center;
            background: linear-gradient(rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.9)), url('https://upload.wikimedia.org/wikipedia/commons/thumb/8/8a/Seal_of_Georgia.svg/200px-Seal_of_Georgia.svg.png') no-repeat center;
            background-size: contain;
        }
        
        .hero h2 {
            font-size: 36px;
            color: var(--houston-blue);
            margin-bottom: 20px;
            font-family: 'Merriweather', serif;
        }
        
        .hero p {
            font-size: 18px;
            max-width: 800px;
            margin: 0 auto 30px;
            color: var(--dark-gray);
        }
        
        .cta-button {
            display: inline-block;
            background: linear-gradient(to right, var(--houston-red), var(--georgia-red));
            color: white;
            padding: 15px 40px;
            font-size: 18px;
            font-weight: 600;
            text-decoration: none;
            border-radius: var(--border-radius);
            transition: all 0.3s ease;
            box-shadow: var(--box-shadow);
        }
        
        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }
        
        /* Features Section */
        .features {
            padding: 60px 0;
            background-color: white;
        }
        
        .section-title {
            text-align: center;
            font-size: 32px;
            color: var(--houston-blue);
            margin-bottom: 50px;
            font-family: 'Merriweather', serif;
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
        }
        
        .feature-card {
            background-color: var(--light-gray);
            border-radius: var(--border-radius);
            padding: 30px;
            text-align: center;
            box-shadow: var(--box-shadow);
            transition: transform 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
        }
        
        .feature-icon {
            width: 70px;
            height: 70px;
            background: linear-gradient(to right, var(--houston-blue), var(--georgia-blue));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-size: 28px;
        }
        
        .feature-card h3 {
            color: var(--houston-blue);
            margin-bottom: 15px;
            font-size: 22px;
        }
        
        /* Form Container */
        .form-container {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 40px;
            margin: 40px auto;
            max-width: 900px;
            display: none;
        }
        
        .form-progress {
            display: flex;
            justify-content: space-between;
            margin-bottom: 40px;
            position: relative;
        }
        
        .form-progress:before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 3px;
            background-color: #e0e0e0;
            z-index: 1;
        }
        
        .progress-step {
            text-align: center;
            position: relative;
            z-index: 2;
            flex: 1;
        }
        
        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #e0e0e0;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .step-circle.active {
            background-color: var(--houston-blue);
            color: white;
        }
        
        .step-circle.completed {
            background-color: var(--houston-gold);
            color: white;
        }
        
        .step-label {
            font-size: 14px;
            color: #666;
            font-weight: 600;
        }
        
        .form-step {
            display: none;
        }
        
        .form-step.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-title {
            color: var(--houston-blue);
            margin-bottom: 30px;
            font-size: 24px;
            font-family: 'Merriweather', serif;
            border-bottom: 2px solid var(--houston-gold);
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .form-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-gray);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-family: 'Open Sans', sans-serif;
            transition: border 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--houston-blue);
            box-shadow: 0 0 0 2px rgba(0, 51, 102, 0.1);
        }
        
        .form-text {
            display: block;
            margin-top: 5px;
            font-size: 0.85em;
            color: #666;
        }
        
        .form-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #eee;
        }
        
        .btn {
            padding: 12px 30px;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-family: 'Open Sans', sans-serif;
        }
        
        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
        }
        
        .btn-primary {
            background-color: var(--houston-blue);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--georgia-blue);
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        
        .btn-outline {
            background-color: white;
            color: var(--houston-blue);
            border: 2px solid var(--houston-blue);
        }
        
        .btn-outline:hover {
            background-color: var(--houston-blue);
            color: white;
        }
        
        .btn-success {
            background-color: var(--success-green);
            color: white;
        }
        
        .btn-success:hover {
            background-color: #218838;
        }
        
        .btn-danger {
            background-color: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c82333;
        }
        
        /* Info Box */
        .info-box {
            background-color: #e8f4fd;
            border-left: 4px solid var(--houston-blue);
            padding: 20px;
            margin-bottom: 30px;
            border-radius: var(--border-radius);
        }
        
        .info-box h4 {
            color: var(--houston-blue);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .info-box.warning {
            background-color: #fff3cd;
            border-left-color: var(--warning-orange);
        }
        
        .info-box.success {
            background-color: #d4edda;
            border-left-color: var(--success-green);
        }
        
        .info-box.info {
            background-color: #e8f4fd;
            border-left-color: var(--houston-blue);
        }
        
        /* Document Preview Section */
        .document-preview {
            margin: 30px 0;
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius);
            overflow: hidden;
        }
        
        .document-header {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .document-actions {
            display: flex;
            gap: 10px;
        }
        
        .document-frame {
            width: 100%;
            height: 500px;
            border: none;
        }
        
        /* Signature Pad */
        .signature-container {
            margin: 30px 0;
        }
        
        .signature-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .signature-pad {
            width: 100%;
            height: 200px;
            border: 2px dashed #ccc;
            border-radius: var(--border-radius);
            background: white;
            cursor: crosshair;
            margin-bottom: 15px;
        }
        
        .signature-actions {
            display: flex;
            gap: 10px;
        }
        
        .signature-preview {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .signature-preview img {
            max-height: 50px;
            border: 1px solid #ccc;
            background: white;
            padding: 5px;
        }
        
        /* Document Download Section */
        .download-section {
            margin: 30px 0;
            text-align: center;
        }
        
        .download-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .download-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius);
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .download-card:hover {
            border-color: var(--houston-blue);
            transform: translateY(-5px);
            box-shadow: var(--box-shadow);
        }
        
        .download-icon {
            width: 60px;
            height: 60px;
            background: var(--houston-blue);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 24px;
        }
        
        .download-card h3 {
            color: var(--houston-blue);
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .download-card p {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
            min-height: 40px;
        }
        
        /* GitHub Configuration */
        .github-config {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 30px 0;
            border: 1px solid #dee2e6;
        }
        
        .github-config h4 {
            color: var(--houston-blue);
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .github-status {
            margin-top: 10px;
            font-size: 0.95em;
            padding: 8px 12px;
            border-radius: 4px;
        }
        
        .github-status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .github-status.warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .github-status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .backup-note {
            color: var(--success-green);
            font-size: 0.95em;
            margin: 12px 0;
            text-align: center;
        }
        
        /* Case Status */
        .case-status {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin: 30px 0;
            display: none;
        }
        
        .status-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .status-timeline {
            display: flex;
            justify-content: space-between;
            position: relative;
            margin: 40px 0;
        }
        
        .status-timeline:before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 3px;
            background: #e0e0e0;
            z-index: 1;
        }
        
        .status-step {
            text-align: center;
            position: relative;
            z-index: 2;
        }
        
        .status-icon {
            width: 40px;
            height: 40px;
            background: #e0e0e0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            color: white;
            font-size: 18px;
        }
        
        .status-step.active .status-icon {
            background: var(--houston-blue);
        }
        
        .status-step.completed .status-icon {
            background: var(--success-green);
        }
        
        /* Footer */
        .footer {
            background-color: var(--georgia-blue);
            color: white;
            padding: 50px 0 20px;
            margin-top: 60px;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-bottom: 40px;
        }
        
        .footer-section h3 {
            font-size: 20px;
            margin-bottom: 20px;
            color: var(--houston-gold);
            font-family: 'Merriweather', serif;
        }
        
        .footer-links {
            list-style: none;
        }
        
        .footer-links li {
            margin-bottom: 10px;
        }
        
        .footer-links a {
            color: #ddd;
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .footer-links a:hover {
            color: var(--houston-gold);
        }
        
        .copyright {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 14px;
            color: #aaa;
        }
        
        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            display: none;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--houston-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Success Message */
        .success-message {
            text-align: center;
            padding: 30px;
            background: #d4edda;
            border: 2px solid #c3e6cb;
            border-radius: var(--border-radius);
            margin: 20px 0;
        }
        
        .success-message i {
            font-size: 60px;
            color: #28a745;
            margin-bottom: 20px;
        }
        
        /* Spinning icon animation */
        .fa-spin {
            animation: fa-spin 1s infinite linear;
        }
        
        @keyframes fa-spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Photo Preview */
        .photo-preview-container {
            border: 2px dashed #ccc;
            padding: 20px;
            text-align: center;
            border-radius: var(--border-radius);
            margin-bottom: 15px;
        }
        
        .photo-preview {
            max-width: 300px;
            max-height: 200px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-top: 15px;
        }
        
        /* Required field indicator */
        .required::after {
            content: " *";
            color: var(--houston-red);
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .header-top {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .contact-info {
                text-align: center;
            }
            
            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
                gap: 20px;
            }
            
            .hero h2 {
                font-size: 28px;
            }
            
            .form-row, .form-row-3 {
                grid-template-columns: 1fr;
            }
            
            .form-container {
                padding: 25px;
            }
            
            .form-actions {
                flex-direction: column;
                gap: 15px;
            }
            
            .btn {
                width: 100%;
            }
            
            .form-progress {
                flex-wrap: wrap;
                gap: 15px;
            }
            
            .progress-step {
                flex: 0 0 calc(50% - 15px);
            }
            
            .download-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <p style="color: white; margin-top: 20px;" id="loadingText">Processing your request...</p>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-top">
                <div class="logo-container">
                    <div class="logo">HC</div>
                    <div class="logo-text">
                        <h1>Houston County Eviction System 2.2</h1>
                        <p>Georgia Magistrate Court - Warner Robins, GA</p>
                    </div>
                </div>
                <div class="contact-info">
                    <p><i class="fas fa-phone"></i> (478) 542-2100</p>
                    <p><i class="fas fa-map-marker-alt"></i> 202 Carl Vinson Pkwy, Warner Robins, GA 31088</p>
                    <p><i class="fas fa-clock"></i> Mon-Fri: 8:00 AM - 5:00 PM</p>
                </div>
            </div>
            
            <nav class="navigation">
                <ul class="nav-links">
                    <li><a href="#"><i class="fas fa-home"></i> Home</a></li>
                    <li><a href="#" id="navStartFiling"><i class="fas fa-file-alt"></i> Start Filing</a></li>
                    <li><a href="dashboard/index.html" target="_blank"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                    <li><a href="#"><i class="fas fa-question-circle"></i> How It Works</a></li>
                    <li><a href="#"><i class="fas fa-gavel"></i> Court Information</a></li>
                    <li><a href="#"><i class="fas fa-dollar-sign"></i> Fee Schedule</a></li>
                    <li><a href="#"><i class="fas fa-envelope"></i> Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h2>File Eviction Cases Online for Houston County, Georgia</h2>
            <p>Our secure online system allows landlords to file dispossessory affidavits, generate required notices, and submit cases directly to the Houston County Magistrate Court. Save time and ensure compliance with Georgia eviction laws.</p>
            <a href="#" class="cta-button" id="startFilingBtn">
                <i class="fas fa-file-signature"></i> Start Eviction Filing
            </a>
        </div>
    </section>

    <!-- Features Section -->
    <section class="features">
        <div class="container">
            <h2 class="section-title">Why File With Our System?</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-file-contract"></i>
                    </div>
                    <h3>Court-Approved Forms</h3>
                    <p>Automatically generate Georgia dispossessory affidavits, 7-day notices, and summons forms that comply with Houston County requirements.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <h3>Faster Processing</h3>
                    <p>Reduce filing time from days to minutes. Submit directly to the court clerk's office without waiting in line.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h3>SCRA Compliance</h3>
                    <p>Automatic Servicemembers Civil Relief Act verification to ensure compliance with federal law.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-cloud"></i>
                    </div>
                    <h3>Automatic GitHub Backup</h3>
                    <p>All cases automatically saved to GitHub repository for secure backup and dashboard access.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Eviction Filing Form (Initially Hidden) -->
    <div class="container">
        <div class="form-container" id="evictionForm">
            <!-- GitHub Configuration (Visible by default) -->
            <div class="github-config">
                <h4><i class="fab fa-github"></i> Automatic GitHub Backup Setup</h4>
                <p style="font-size:0.9em; margin-bottom:15px;">
                    <strong>Required for saving cases:</strong> Enter your GitHub Personal Access Token.<br>
                    <small><a href="https://github.com/settings/tokens" target="_blank">Get token here</a> (needs <strong>repo</strong> scope)</small>
                </p>
                <div class="form-group">
                    <label for="githubToken">GitHub Personal Access Token</label>
                    <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
                </div>
                <label style="display:block; margin:10px 0;">
                    <input type="checkbox" id="githubEnabled" checked> Enable automatic GitHub backup
                </label>
                <div id="githubStatus" class="github-status">
                    <i class="fas fa-info-circle"></i> Enter token above to enable backup
                </div>
                <div style="margin-top: 10px; font-size: 0.85em; color: #666;">
                    <p><strong>Repository:</strong> <a href="https://github.com/NAGOHUSA/GAEVIC" target="_blank">NAGOHUSA/GAEVIC</a></p>
                    <p><strong>Path:</strong> <code>cases/case_data.json</code></p>
                </div>
            </div>

            <!-- Form Progress -->
            <div class="form-progress">
                <div class="progress-step">
                    <div class="step-circle active" id="step1Circle">1</div>
                    <div class="step-label">Landlord Info</div>
                </div>
                <div class="progress-step">
                    <div class="step-circle" id="step2Circle">2</div>
                    <div class="step-label">Property Info</div>
                </div>
                <div class="progress-step">
                    <div class="step-circle" id="step3Circle">3</div>
                    <div class="step-label">3-Day Notice</div>
                </div>
                <div class="progress-step">
                    <div class="step-circle" id="step4Circle">4</div>
                    <div class="step-label">Tenant Info</div>
                </div>
                <div class="progress-step">
                    <div class="step-circle" id="step5Circle">5</div>
                    <div class="step-label">Case Details</div>
                </div>
                <div class="progress-step">
                    <div class="step-circle" id="step6Circle">6</div>
                    <div class="step-label">E-Signature</div>
                </div>
                <div class="progress-step">
                    <div class="step-circle" id="step7Circle">7</div>
                    <div class="step-label">Submit & Save</div>
                </div>
            </div>
            
            <!-- Step 1: Landlord Information -->
            <div class="form-step active" id="step1">
                <h2 class="form-title">Landlord Information</h2>
                
                <div class="info-box">
                    <h4><i class="fas fa-info-circle"></i> Important Notice</h4>
                    <p>You must be the property owner or authorized agent to file an eviction. If filing as an agent, you must have written authorization from the property owner.</p>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="landlordName" class="required">Full Legal Name</label>
                        <input type="text" id="landlordName" placeholder="Enter your full name as it appears on the deed" required>
                    </div>
                    <div class="form-group">
                        <label for="landlordPhone" class="required">Phone Number</label>
                        <input type="tel" id="landlordPhone" placeholder="(478) 123-4567" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="landlordEmail" class="required">Email Address</label>
                        <input type="email" id="landlordEmail" placeholder="your@email.com" required>
                    </div>
                    <div class="form-group">
                        <label for="landlordType">Filing As</label>
                        <select id="landlordType">
                            <option value="owner">Property Owner</option>
                            <option value="agent">Authorized Agent</option>
                            <option value="property_manager">Property Manager</option>
                            <option value="attorney">Attorney</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="landlordAddress" class="required">Mailing Address Line 1</label>
                    <input type="text" id="landlordAddress" placeholder="Street Address" required>
                </div>
                
                <div class="form-group">
                    <label for="landlordAddress2">Mailing Address Line 2</label>
                    <input type="text" id="landlordAddress2" placeholder="Suite, Unit, Building, etc. (Optional)">
                </div>
                
                <div class="form-row-3">
                    <div class="form-group">
                        <label for="landlordCity" class="required">City</label>
                        <input type="text" id="landlordCity" placeholder="City" required>
                    </div>
                    <div class="form-group">
                        <label for="landlordState" class="required">State</label>
                        <select id="landlordState">
                            <option value="GA" selected>Georgia</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="landlordZip" class="required">ZIP Code</label>
                        <input type="text" id="landlordZip" placeholder="31088" required maxlength="5">
                        <small class="form-text" id="zipValidation"></small>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" id="cancelBtn">Cancel</button>
                    <button type="button" class="btn btn-primary" id="nextStep1">Next: Property Information</button>
                </div>
            </div>
            
            <!-- Step 2: Property Information -->
            <div class="form-step" id="step2">
                <h2 class="form-title">Property Information</h2>
                
                <div class="info-box">
                    <h4><i class="fas fa-map-marker-alt"></i> Location Requirements</h4>
                    <p>The property must be located within Houston County, Georgia. This system only handles evictions for properties in Houston County.</p>
                </div>
                
                <div class="form-group">
                    <label for="propertyAddress" class="required">Property Address</label>
                    <input type="text" id="propertyAddress" placeholder="Street Address of the rental property" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="propertyCity" class="required">City</label>
                        <select id="propertyCity" required>
                            <option value="Warner Robins" selected>Warner Robins</option>
                            <option value="Perry">Perry</option>
                            <option value="Centerville">Centerville</option>
                            <option value="Bonaire">Bonaire</option>
                            <option value="Kathleen">Kathleen</option>
                            <option value="Other">Other Houston County Location</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="propertyZip" class="required">ZIP Code</label>
                        <input type="text" id="propertyZip" placeholder="31088" required maxlength="5">
                        <small class="form-text" id="propertyZipValidation"></small>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="propertyType">Property Type</label>
                        <select id="propertyType">
                            <option value="single_family">Single Family Home</option>
                            <option value="apartment">Apartment</option>
                            <option value="condo">Condominium</option>
                            <option value="townhome">Townhome</option>
                            <option value="mobile_home">Mobile Home</option>
                            <option value="commercial">Commercial Property</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="unitNumber">Unit Number (if applicable)</label>
                        <input type="text" id="unitNumber" placeholder="Apt 3B, Unit 12, etc.">
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="prevStep2">Previous</button>
                    <button type="button" class="btn btn-primary" id="nextStep2">Next: 3-Day Notice Documentation</button>
                </div>
            </div>
            
            <!-- Step 3: Notice Documentation -->
            <div class="form-step" id="step3">
                <h2 class="form-title">3-Day Notice Documentation</h2>
                
                <div class="info-box warning">
                    <h4><i class="fas fa-exclamation-triangle"></i> Georgia 3-Day Notice Requirement</h4>
                    <p><strong>NEW GEORGIA LAW:</strong> Landlords must now post the 3-day "Pay or Quit" notice 
                    <strong>physically on the front door</strong> of the rental property prior to filing for eviction.</p>
                    <p>The 3-day notice period runs from when you post the notice. The court will then serve 
                    the eviction notice, giving the tenant 7 days to respond.</p>
                </div>
                
                <div class="form-group">
                    <label for="noticePostingDate" class="required">Date Notice Was Posted on Property</label>
                    <input type="date" id="noticePostingDate" required>
                    <small class="form-text">Must be at least 3 days before today's date</small>
                </div>
                
                <div class="form-group">
                    <label for="noticeMethod" class="required">How Was Notice Delivered?</label>
                    <select id="noticeMethod" required>
                        <option value="posted_door">Posted on Front Door (Required)</option>
                        <option value="posted_door_certified">Posted on Door + Certified Mail</option>
                        <option value="personal_delivery">Personal Delivery to Tenant</option>
                        <option value="other">Other Method</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="noticeDetails" class="required">Details of Notice Delivery</label>
                    <textarea id="noticeDetails" rows="3" placeholder="Describe exactly how and when the notice was delivered (e.g., 'Posted on bright orange paper on front door at 2:00 PM on 10/15/2023. Photo taken as evidence.')" required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="noticePhoto">Upload Photo of Posted Notice (Strongly Recommended)</label>
                    <div class="photo-preview-container">
                        <i class="fas fa-camera" style="font-size: 40px; color: #666; margin-bottom: 10px;"></i>
                        <p style="margin-bottom: 15px;">Upload a clear photo showing the notice posted on the front door</p>
                        <input type="file" id="noticePhoto" accept="image/*" capture="environment">
                        <div id="photoPreview" style="margin-top: 15px; display: none;">
                            <img id="previewImage" src="" alt="Notice Photo Preview" class="photo-preview">
                            <button type="button" id="removePhoto" class="btn btn-danger btn-sm" style="margin-top: 10px;">
                                <i class="fas fa-trash"></i> Remove Photo
                            </button>
                        </div>
                    </div>
                    <small class="form-text">Photo evidence can prevent delays if the tenant claims they never received notice</small>
                </div>
                
                <div class="info-box">
                    <h4><i class="fas fa-lightbulb"></i> Best Practices</h4>
                    <ol style="margin: 10px 0 0 20px;">
                        <li>Use bright-colored paper (orange or red recommended)</li>
                        <li>Post at eye level on the main entry door</li>
                        <li>Take photo with timestamp showing clearly</li>
                        <li>Keep copy for your records</li>
                        <li>Wait full 3 business days before filing</li>
                    </ol>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="prevStep3">Previous</button>
                    <button type="button" class="btn btn-primary" id="nextStep3">Next: Tenant Information</button>
                </div>
            </div>
            
            <!-- Step 4: Tenant Information -->
            <div class="form-step" id="step4">
                <h2 class="form-title">Tenant Information</h2>
                
                <div class="info-box">
                    <h4><i class="fas fa-user-friends"></i> Multiple Tenants</h4>
                    <p>If there are multiple tenants on the lease, you'll need to provide information for each one. You can add additional tenants after completing this section.</p>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="tenantName" class="required">Tenant Full Name</label>
                        <input type="text" id="tenantName" placeholder="Tenant's legal name" required>
                    </div>
                    <div class="form-group">
                        <label for="tenantPhone">Tenant Phone Number</label>
                        <input type="tel" id="tenantPhone" placeholder="(478) 123-4567">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="tenantEmail">Tenant Email (if known)</label>
                        <input type="email" id="tenantEmail" placeholder="tenant@email.com">
                    </div>
                    <div class="form-group">
                        <label for="tenantAltAddress">Alternate Mailing Address</label>
                        <input type="text" id="tenantAltAddress" placeholder="If different from property address">
                    </div>
                </div>
                
                <div class="form-group">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <input type="checkbox" id="militaryCheck" style="width: auto;">
                        <label for="militaryCheck" style="margin: 0;">I believe this tenant may be an active duty service member</label>
                    </div>
                    <p class="small-text"><i class="fas fa-exclamation-triangle" style="color: #dc3545;"></i> The court will verify military status through the SCRA database. False statements may result in dismissal of your case.</p>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="prevStep4">Previous</button>
                    <button type="button" class="btn btn-primary" id="nextStep4">Next: Case Details</button>
                </div>
            </div>
            
            <!-- Step 5: Case Details -->
            <div class="form-step" id="step5">
                <h2 class="form-title">Case Details</h2>
                
                <div class="info-box">
                    <h4><i class="fas fa-balance-scale"></i> Georgia Eviction Laws</h4>
                    <p>In Georgia, you must have legal grounds for eviction. Common reasons include non-payment of rent, lease violations, or holdover tenancy after lease expiration.</p>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="leaseType" class="required">Lease Type</label>
                        <select id="leaseType" required>
                            <option value="month_to_month">Month-to-Month</option>
                            <option value="fixed_term">Fixed Term Lease</option>
                            <option value="week_to_week">Week-to-Week</option>
                            <option value="verbal">Verbal Agreement</option>
                            <option value="no_lease">No Lease Agreement</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="reason" class="required">Reason for Eviction</label>
                        <select id="reason" required>
                            <option value="non_payment">Non-Payment of Rent</option>
                            <option value="lease_violation">Lease Violation</option>
                            <option value="holdover">Holdover (Lease Expired)</option>
                            <option value="property_damage">Property Damage</option>
                            <option value="illegal_activity">Illegal Activity</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="rentAmount" class="required">Monthly Rent Amount</label>
                        <div style="position: relative;">
                            <span style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%);">$</span>
                            <input type="number" id="rentAmount" placeholder="0.00" style="padding-left: 30px;" min="0" step="0.01" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="amountOwed" class="required">Total Amount Owed</label>
                        <div style="position: relative;">
                            <span style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%);">$</span>
                            <input type="number" id="amountOwed" placeholder="0.00" style="padding-left: 30px;" min="0" step="0.01" required>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="lastPaymentDate">Last Payment Received</label>
                        <input type="date" id="lastPaymentDate">
                    </div>
                    <div class="form-group">
                        <label for="noticeDate" class="required">Date 3-Day Notice Expires</label>
                        <input type="date" id="noticeDate" required>
                        <small class="form-text">3 days after posting notice on property</small>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="caseDetails">Additional Case Details</label>
                    <textarea id="caseDetails" rows="3" placeholder="Any additional information about the case (lease violations, property damage, etc.)"></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="prevStep5">Previous</button>
                    <button type="button" class="btn btn-primary" id="nextStep5">Next: E-Signature</button>
                </div>
            </div>
            
            <!-- Step 6: E-Signature -->
            <div class="form-step" id="step6">
                <h2 class="form-title">E-Sign Documents</h2>
                
                <div class="info-box">
                    <h4><i class="fas fa-signature"></i> Electronic Signature</h4>
                    <p>Your electronic signature has the same legal effect as a handwritten signature for Houston County eviction filings.</p>
                </div>
                
                <div class="signature-container">
                    <div class="signature-header">
                        <h3 style="margin: 0;">Sign Documents</h3>
                        <div class="signature-status">
                            <span id="signatureStatus" style="color: #666; font-weight: 600;">
                                <i class="fas fa-pen"></i> Ready to sign
                            </span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="signerName" class="required">Full Name (as it will appear on signature)</label>
                        <input type="text" id="signerName" placeholder="Enter your full legal name" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Draw your signature below:</label>
                        <canvas id="signaturePad" class="signature-pad"></canvas>
                    </div>
                    
                    <div class="signature-actions">
                        <button class="btn btn-secondary" id="clearSignature">
                            <i class="fas fa-eraser"></i> Clear Signature
                        </button>
                        <button class="btn btn-outline" id="typeSignature">
                            <i class="fas fa-keyboard"></i> Type Signature
                        </button>
                        <button class="btn btn-success" id="saveSignature">
                            <i class="fas fa-save"></i> Save Signature
                        </button>
                    </div>
                    
                    <div id="signaturePreview" class="signature-preview" style="display: none;">
                        <div>
                            <strong>Signature Saved:</strong>
                            <p style="margin: 5px 0; color: #666;">Your signature will be applied to all documents</p>
                        </div>
                        <img id="signatureImage" src="" alt="Signature">
                    </div>
                </div>
                
                <div class="info-box warning">
                    <h4><i class="fas fa-shield-alt"></i> Legal Certification</h4>
                    <div style="display: flex; align-items: flex-start; gap: 10px; margin-top: 10px;">
                        <input type="checkbox" id="legalCertify" style="margin-top: 3px;">
                        <label for="legalCertify" style="margin: 0;">
                            I certify under penalty of perjury that the information provided is true and correct to the best of my knowledge, and that I am authorized to sign these documents.
                        </label>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="prevStep6">Previous</button>
                    <button type="button" class="btn btn-primary" id="nextStep6" disabled>Next: Save to GitHub</button>
                </div>
            </div>
            
            <!-- Step 7: Submit & Save to GitHub -->
            <div class="form-step" id="step7">
                <h2 class="form-title">Save to GitHub & Download Documents</h2>
                
                <div class="success-message" id="successMessage">
                    <i class="fas fa-sync-alt fa-spin"></i>
                    <h3>Generating Documents...</h3>
                    <p>Please wait while we create your documents and save to GitHub.</p>
                </div>
                
                <div id="githubResultMessage" style="display: none;"></div>
                
                <div class="info-box">
                    <h4><i class="fas fa-file-invoice-dollar"></i> Houston County Filing Fee Information</h4>
                    <p><strong>Current Filing Fees (2024):</strong></p>
                    <ul style="margin: 10px 0 10px 20px;">
                        <li>One Defendant: <strong>$109.00</strong> (plus 3 copies of all supporting documents)</li>
                        <li>Two Defendants: <strong>$159.00</strong> (plus 5 copies of all supporting documents)</li>
                        <li>Three Defendants: <strong>$209.00</strong> (plus 7 copies of all supporting documents)</li>
                        <li>Each additional Defendant: <strong>$50.00</strong></li>
                        <li>Re-Serve Fee: <strong>$50.00</strong> per Defendant</li>
                    </ul>
                    <p><strong>Payment Methods Accepted:</strong> Cash (exact amount), Company Checks, Money Orders</p>
                    <p><em>Note: This system generates the required documents. You must take them to the Houston County Magistrate Court to file and pay the fee.</em></p>
                </div>
                
                <div class="download-section">
                    <h3 style="color: var(--houston-blue); margin-bottom: 20px;">Download Your Eviction Documents</h3>
                    <p style="margin-bottom: 30px;">All required Houston County eviction forms have been generated with your information. Download each document individually or get all documents in a single ZIP file.</p>
                    
                    <div class="download-grid">
                        <div class="download-card">
                            <div class="download-icon">
                                <i class="fas fa-file-pdf"></i>
                            </div>
                            <h3>Complete Houston County Package</h3>
                            <p>Official court forms with all sections: Affidavit, Application, Military Form, and Instructions</p>
                            <button class="btn btn-primary download-doc" data-doc="houston_package">
                                <i class="fas fa-download"></i> Download Complete PDF
                            </button>
                        </div>
                        
                        <div class="download-card">
                            <div class="download-icon">
                                <i class="fas fa-file-contract"></i>
                            </div>
                            <h3>7-Day Demand Notice</h3>
                            <p>Official notice to tenant as required by OCGA  44-7-50</p>
                            <button class="btn btn-outline download-doc" data-doc="demand_notice">
                                <i class="fas fa-download"></i> Download PDF
                            </button>
                        </div>
                        
                        <div class="download-card">
                            <div class="download-icon">
                                <i class="fas fa-gavel"></i>
                            </div>
                            <h3>Dispossessory Affidavit</h3>
                            <p>Court filing affidavit for eviction proceedings</p>
                            <button class="btn btn-outline download-doc" data-doc="affidavit">
                                <i class="fas fa-download"></i> Download PDF
                            </button>
                        </div>
                        
                        <div class="download-card">
                            <div class="download-icon">
                                <i class="fas fa-file-signature"></i>
                            </div>
                            <h3>Summons</h3>
                            <p>Official court summons for the tenant</p>
                            <button class="btn btn-outline download-doc" data-doc="summons">
                                <i class="fas fa-download"></i> Download PDF
                            </button>
                        </div>
                        
                        <div class="download-card">
                            <div class="download-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <h3>SCRA Verification</h3>
                            <p>Military service verification form</p>
                            <button class="btn btn-outline download-doc" data-doc="scra_form">
                                <i class="fas fa-download"></i> Download PDF
                            </button>
                        </div>
                    </div>
                    
                    <div style="margin-top: 40px;">
                        <button class="btn btn-success" id="downloadAllBtn" style="padding: 15px 40px; font-size: 18px;">
                            <i class="fas fa-file-archive"></i> Download All Documents (ZIP)
                        </button>
                    </div>
                    
                    <div class="info-box warning" style="margin-top: 30px;">
                        <h4><i class="fas fa-exclamation-triangle"></i> Next Steps for Court Filing</h4>
                        <ol style="margin: 10px 0 0 20px;">
                            <li>Print ALL downloaded documents (minimum copies required based on number of defendants)</li>
                            <li>Sign the printed documents (if not already e-signed)</li>
                            <li>Make copies of your lease agreement and payment ledger</li>
                            <li>Take all documents to Houston County Magistrate Court: 89 Cohen Walker Drive, Warner Robins, GA 31088</li>
                            <li>Pay the filing fee at the court (see fee schedule above)</li>
                            <li>The court will issue a case number and schedule service</li>
                        </ol>
                    </div>
                    
                    <div class="info-box" style="margin-top: 20px;">
                        <h4><i class="fas fa-search"></i> Online Case Search</h4>
                        <p>After filing, you can check your case status online:</p>
                        <p><a href="http://www.houstoncountyga.gov" target="_blank">http://www.houstoncountyga.gov</a></p>
                        <p>Click "Online Services" tab  Select "Magistrate Court Case Search"</p>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="prevStep7">Previous</button>
                    <button type="button" class="btn btn-outline" id="startNewBtn">
                        <i class="fas fa-plus"></i> Start New Filing
                    </button>
                    <button type="button" class="btn btn-primary" id="openDashboardBtn" style="display: none;">
                        <i class="fas fa-tachometer-alt"></i> Open Dashboard
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Houston County Magistrate Court</h3>
                    <p>89 Cohen Walker Drive<br>
                    Warner Robins, GA 31088<br>
                    Phone: (478) 987-4695<br>
                    Fax: (478) 987-5255<br>
                    Hours: Monday-Friday, 8:30 AM - 4:30 PM</p>
                </div>
                
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul class="footer-links">
                        <li><a href="#" id="footerStartFiling">Start New Filing</a></li>
                        <li><a href="dashboard/index.html" target="_blank">Dashboard</a></li>
                        <li><a href="#">Check Case Status</a></li>
                        <li><a href="#">Court Rules & Procedures</a></li>
                        <li><a href="#">Eviction Timeline</a></li>
                        <li><a href="#">Fee Schedule</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3>Resources</h3>
                    <ul class="footer-links">
                        <li><a href="#">Georgia Landlord-Tenant Handbook</a></li>
                        <li><a href="#">SCRA Information</a></li>
                        <li><a href="#">Legal Aid Services</a></li>
                        <li><a href="#">Forms & Documents</a></li>
                        <li><a href="#">FAQs</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="copyright">
                <p> 2026 Houston County Eviction Filing System. This is a system for filing eviction cases in Houston County. Unauthorized use is prohibited.</p>
                <p style="margin-top: 10px;">This system is designed to assist with proper filing but does not constitute legal advice. Consult an attorney for legal questions.</p>
            </div>
        </div>
    </footer>

    <script>
        // === VARIABLES ===
        const { jsPDF } = window.jspdf;
        let currentStep = 1;
        let formData = {};
        let generatedDocuments = {};
        let signatureData = null;
        let caseId = null;
        let noticePhotoData = null;

        // === GITHUB CONFIG ===
        const GITHUB = {
            owner: 'NAGOHUSA',
            repo: 'GAEVIC',
            branch: 'main',
            basePath: 'cases/'
        };

        let githubToken = localStorage.getItem('githubToken') || '';
        let githubEnabled = localStorage.getItem('githubEnabled') !== 'false';

        // === VALIDATE GITHUB TOKEN ===
        function validateGitHubToken(token) {
            if (!token) return { valid: false, error: 'Token is empty' };
            if (!token.startsWith('ghp_') && !token.startsWith('github_pat_')) {
                return { valid: false, error: 'Token should start with ghp_ or github_pat_' };
            }
            if (token.length < 30) {
                return { valid: false, error: 'Token appears too short' };
            }
            return { valid: true };
        }

        // === UI INIT ===
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize GitHub UI
            const tokenInput = document.getElementById('githubToken');
            const enabledInput = document.getElementById('githubEnabled');
            const statusDiv = document.getElementById('githubStatus');

            if (tokenInput) {
                tokenInput.value = githubToken;
                tokenInput.addEventListener('input', e => {
                    githubToken = e.target.value.trim();
                    localStorage.setItem('githubToken', githubToken);
                    updateStatus();
                });
                
                // Auto-test token when user stops typing
                let typingTimer;
                tokenInput.addEventListener('keyup', () => {
                    clearTimeout(typingTimer);
                    typingTimer = setTimeout(() => {
                        if (githubToken) {
                            testGitHubToken(githubToken);
                        }
                    }, 1000);
                });
            }

            if (enabledInput) {
                enabledInput.checked = githubEnabled;
                enabledInput.addEventListener('change', e => {
                    githubEnabled = e.target.checked;
                    localStorage.setItem('githubEnabled', githubEnabled);
                    updateStatus();
                });
            }

            function updateStatus() {
                if (!statusDiv) return;
                
                const validation = validateGitHubToken(githubToken);
                
                if (!githubEnabled) {
                    statusDiv.innerHTML = '<i class="fas fa-ban"></i> Automatic backup is turned off';
                    statusDiv.className = 'github-status warning';
                } else if (!githubToken) {
                    statusDiv.innerHTML = '<i class="fas fa-key"></i> Enter GitHub token to enable backup';
                    statusDiv.className = 'github-status warning';
                } else if (!validation.valid) {
                    statusDiv.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${validation.error}`;
                    statusDiv.className = 'github-status error';
                } else {
                    statusDiv.innerHTML = '<i class="fas fa-check"></i> Token format looks good';
                    statusDiv.className = 'github-status success';
                }
            }
            
            // Test GitHub token function
            async function testGitHubToken(token) {
                if (!token) return;
                
                statusDiv.innerHTML = '<i class="fas fa-sync fa-spin"></i> Testing token...';
                statusDiv.className = 'github-status';
                
                try {
                    // Test token by trying to access repo info
                    const headers = {
                        'Accept': 'application/vnd.github.v3+json',
                        'Authorization': `Bearer ${token}`,
                        'User-Agent': 'EvictionSystem/2.0'
                    };
                    
                    // Test 1: Check if token is valid
                    const userResponse = await axios.get('https://api.github.com/user', { headers });
                    
                    // Test 2: Check if repo exists and accessible
                    const repoResponse = await axios.get(
                        `https://api.github.com/repos/${GITHUB.owner}/${GITHUB.repo}`,
                        { headers }
                    );
                    
                    statusDiv.innerHTML = `<i class="fas fa-check-circle"></i> Token valid! Connected as: ${userResponse.data.login}`;
                    statusDiv.className = 'github-status success';
                    
                    console.log('GitHub token test successful:', {
                        user: userResponse.data.login,
                        repo: repoResponse.data.full_name,
                        permissions: repoResponse.data.permissions
                    });
                    
                } catch (error) {
                    let errorMessage = 'Token validation failed';
                    
                    if (error.response) {
                        if (error.response.status === 401) {
                            errorMessage = 'Invalid token: 401 Unauthorized';
                        } else if (error.response.status === 403) {
                            errorMessage = 'Token lacks required permissions';
                        } else if (error.response.status === 404) {
                            errorMessage = `Repository not found: ${GITHUB.owner}/${GITHUB.repo}`;
                        } else {
                            errorMessage = `GitHub API error: ${error.response.status}`;
                        }
                    } else if (error.request) {
                        errorMessage = 'No response from GitHub (network error)';
                    } else {
                        errorMessage = `Error: ${error.message}`;
                    }
                    
                    statusDiv.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${errorMessage}`;
                    statusDiv.className = 'github-status error';
                    
                    console.error('GitHub token test failed:', error);
                }
            }
            
            updateStatus();
            
            // If we have a token, test it on load
            if (githubToken && githubEnabled) {
                setTimeout(() => testGitHubToken(githubToken), 1000);
            }

            // DOM Elements
            const startFilingBtn = document.getElementById('startFilingBtn');
            const navStartFiling = document.getElementById('navStartFiling');
            const footerStartFiling = document.getElementById('footerStartFiling');
            const evictionForm = document.getElementById('evictionForm');
            const cancelBtn = document.getElementById('cancelBtn');
            const loadingOverlay = document.getElementById('loadingOverlay');
            const loadingText = document.getElementById('loadingText');
            const successMessage = document.getElementById('successMessage');

            // Show/Hide Form
            function showForm() {
                evictionForm.style.display = 'block';
                window.scrollTo({
                    top: evictionForm.offsetTop - 20,
                    behavior: 'smooth'
                });
            }
            
            startFilingBtn.addEventListener('click', function(e) {
                e.preventDefault();
                showForm();
            });
            
            navStartFiling.addEventListener('click', function(e) {
                e.preventDefault();
                showForm();
            });
            
            footerStartFiling.addEventListener('click', function(e) {
                e.preventDefault();
                showForm();
            });
            
            cancelBtn.addEventListener('click', function() {
                if (confirm('Are you sure you want to cancel? All entered information will be lost.')) {
                    evictionForm.style.display = 'none';
                    resetForm();
                }
            });
            
            // Step Navigation
            function goToStep(step) {
                // Hide current step
                document.getElementById(`step${currentStep}`).classList.remove('active');
                document.getElementById(`step${currentStep}Circle`).classList.remove('active');
                
                // Update current step
                currentStep = step;
                
                // Show new step
                document.getElementById(`step${currentStep}`).classList.add('active');
                document.getElementById(`step${currentStep}Circle`).classList.add('active');
                
                // Mark previous steps as completed
                for (let i = 1; i < currentStep; i++) {
                    document.getElementById(`step${i}Circle`).classList.add('completed');
                }
                
                // Clear completed status for steps after current
                for (let i = currentStep + 1; i <= 7; i++) {
                    document.getElementById(`step${i}Circle`).classList.remove('completed');
                }
                
                // Handle step-specific initialization
                if (currentStep === 6) {
                    initializeSignaturePad();
                    document.getElementById('signerName').value = document.getElementById('landlordName').value;
                } else if (currentStep === 7) {
                    generateCaseId();
                    generateAllDocuments();
                    
                    // Show uploading status
                    successMessage.innerHTML = `
                        <i class="fas fa-sync-alt fa-spin"></i>
                        <h3>Saving to GitHub...</h3>
                        <p>Please wait while we save your case to the repository.</p>
                        <p><strong>Case ID:</strong> ${caseId}</p>
                    `;
                    
                    // Auto upload to GitHub
                    setTimeout(async () => {
                        try {
                            await uploadCaseToGitHub();
                        } catch (error) {
                            console.error('Upload failed:', error);
                        }
                    }, 500);
                }
                
                // Scroll to top of form
                evictionForm.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
            
            // Next Step Buttons
            document.getElementById('nextStep1').addEventListener('click', () => goToStep(2));
            document.getElementById('nextStep2').addEventListener('click', () => {
                // Validate property is in Houston County
                const zip = document.getElementById('propertyZip').value.trim();
                const houstonZips = ['31088', '31069', '31028', '31005', '31047'];
                
                if (!houstonZips.includes(zip)) {
                    alert('Warning: The ZIP code entered is not a recognized Houston County ZIP code. Please verify the property is located in Houston County, Georgia.');
                }
                goToStep(3);
            });
            document.getElementById('nextStep3').addEventListener('click', () => {
                // Validate notice date is at least 3 days ago
                const noticeDate = new Date(document.getElementById('noticePostingDate').value);
                const today = new Date();
                const threeDaysAgo = new Date();
                threeDaysAgo.setDate(today.getDate() - 3);
                
                if (noticeDate > threeDaysAgo) {
                    alert('Warning: The notice posting date must be at least 3 days before today. Georgia law requires a 3-day notice period before filing.');
                    return;
                }
                goToStep(4);
            });
            document.getElementById('nextStep4').addEventListener('click', () => goToStep(5));
            document.getElementById('nextStep5').addEventListener('click', () => goToStep(6));
            
            // Previous Step Buttons
            document.getElementById('prevStep2').addEventListener('click', () => goToStep(1));
            document.getElementById('prevStep3').addEventListener('click', () => goToStep(2));
            document.getElementById('prevStep4').addEventListener('click', () => goToStep(3));
            document.getElementById('prevStep5').addEventListener('click', () => goToStep(4));
            document.getElementById('prevStep6').addEventListener('click', () => goToStep(5));
            document.getElementById('prevStep7').addEventListener('click', () => goToStep(6));
            
            // Zip code auto-fill for Houston County
            document.getElementById('landlordZip').addEventListener('blur', function() {
                const zip = this.value.trim();
                const cityField = document.getElementById('landlordCity');
                const validationText = document.getElementById('zipValidation');
                
                const houstonCountyZips = {
                    '31088': 'Warner Robins',
                    '31069': 'Perry',
                    '31028': 'Centerville',
                    '31005': 'Bonaire',
                    '31047': 'Kathleen'
                };
                
                if (houstonCountyZips[zip]) {
                    cityField.value = houstonCountyZips[zip];
                    validationText.textContent = ' Houston County zip code';
                    validationText.style.color = 'var(--success-green)';
                } else if (zip.length === 5) {
                    validationText.textContent = ' Not a recognized Houston County zip code';
                    validationText.style.color = 'var(--warning-orange)';
                }
            });
            
            // Property zip validation
            document.getElementById('propertyZip').addEventListener('blur', function() {
                const zip = this.value.trim();
                const validationText = document.getElementById('propertyZipValidation');
                const houstonZips = ['31088', '31069', '31028', '31005', '31047'];
                
                if (houstonZips.includes(zip)) {
                    validationText.textContent = ' Valid Houston County ZIP';
                    validationText.style.color = 'var(--success-green)';
                } else if (zip.length === 5) {
                    validationText.textContent = ' Property must be in Houston County, GA';
                    validationText.style.color = 'var(--warning-orange)';
                }
            });
            
            // Photo upload handling
            const noticePhoto = document.getElementById('noticePhoto');
            const previewImage = document.getElementById('previewImage');
            const photoPreview = document.getElementById('photoPreview');
            const removePhoto = document.getElementById('removePhoto');

            noticePhoto.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    // Validate file size (max 5MB)
                    if (file.size > 5 * 1024 * 1024) {
                        alert('File size must be less than 5MB');
                        this.value = '';
                        return;
                    }
                    
                    // Validate file type
                    if (!file.type.startsWith('image/')) {
                        alert('Please upload an image file');
                        this.value = '';
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        previewImage.src = e.target.result;
                        photoPreview.style.display = 'block';
                        noticePhotoData = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });

            removePhoto.addEventListener('click', function() {
                noticePhoto.value = '';
                previewImage.src = '';
                photoPreview.style.display = 'none';
                noticePhotoData = null;
            });
            
            // Generate Case ID
            function generateCaseId() {
                const timestamp = Date.now();
                const randomNum = Math.floor(Math.random() * 10000);
                caseId = `HOU-${new Date().getFullYear()}-${timestamp.toString().slice(-6)}-${randomNum.toString().padStart(4, '0')}`;
                return caseId;
            }
            
            // Collect Form Data
            function collectFormData() {
                // Calculate notice expiry date (3 days after posting)
                const noticePostingDate = new Date(document.getElementById('noticePostingDate').value);
                const noticeExpiryDate = new Date(noticePostingDate);
                noticeExpiryDate.setDate(noticeExpiryDate.getDate() + 3);
                
                formData = {
                    caseId: caseId,
                    status: 'Pending Court Filing',
                    filingDate: new Date().toISOString(),
                    landlord: {
                        name: document.getElementById('landlordName').value,
                        phone: document.getElementById('landlordPhone').value,
                        email: document.getElementById('landlordEmail').value,
                        type: document.getElementById('landlordType').value,
                        address: document.getElementById('landlordAddress').value,
                        address2: document.getElementById('landlordAddress2').value,
                        city: document.getElementById('landlordCity').value,
                        state: document.getElementById('landlordState').value,
                        zip: document.getElementById('landlordZip').value
                    },
                    property: {
                        address: document.getElementById('propertyAddress').value,
                        city: document.getElementById('propertyCity').value,
                        zip: document.getElementById('propertyZip').value,
                        type: document.getElementById('propertyType').value,
                        unit: document.getElementById('unitNumber').value
                    },
                    notice: {
                        postingDate: document.getElementById('noticePostingDate').value,
                        expiryDate: noticeExpiryDate.toISOString().split('T')[0],
                        method: document.getElementById('noticeMethod').value,
                        details: document.getElementById('noticeDetails').value,
                        photo: noticePhotoData
                    },
                    tenant: {
                        name: document.getElementById('tenantName').value,
                        phone: document.getElementById('tenantPhone').value,
                        email: document.getElementById('tenantEmail').value,
                        altAddress: document.getElementById('tenantAltAddress').value,
                        militaryCheck: document.getElementById('militaryCheck').checked
                    },
                    case: {
                        leaseType: document.getElementById('leaseType').value,
                        reason: document.getElementById('reason').value,
                        rentAmount: parseFloat(document.getElementById('rentAmount').value) || 0,
                        amountOwed: parseFloat(document.getElementById('amountOwed').value) || 0,
                        lastPaymentDate: document.getElementById('lastPaymentDate').value,
                        noticeDate: document.getElementById('noticeDate').value,
                        details: document.getElementById('caseDetails').value
                    },
                    signature: signatureData ? {
                        name: signatureData.name,
                        timestamp: signatureData.timestamp
                    } : null,
                    timestamp: new Date().toISOString(),
                    documentsGenerated: true,
                    version: '2.1'
                };
                return formData;
            }
            
            // Generate All Documents
            function generateAllDocuments() {
                collectFormData();
                generatedDocuments = {
                    houston_package: generateHoustonCountyPackage(),
                    demand_notice: generateDemandNotice(),
                    affidavit: generateAffidavit(),
                    summons: generateSummons(),
                    scra_form: generateSCRACertification()
                };
                
                // Set up download buttons
                setupDownloadButtons();
            }
            
            // Document Generation Functions
            function generateHoustonCountyPackage() {
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                
                // ===== PAGE 1: COURT HEADER AND FEE SCHEDULE =====
                doc.setFontSize(10);
                doc.text("89 Cohen Walker Drive  Warner Robins, Georgia 31088", 20, 10);
                doc.text("Phone (478) 987-4695  Fax (478) 987-5255", 20, 15);
                doc.text("Hours: 8:30 am - 4:30 pm", 20, 20);
                doc.text("magistrate@houstoncountyga.gov", 20, 25);
                
                // Fee Schedule
                doc.setFontSize(14);
                doc.setFont("helvetica", "bold");
                doc.text("DISPOSSESSORY FILING FEES:", 20, 40);
                
                doc.setFontSize(11);
                doc.setFont("helvetica", "normal");
                doc.text("One Defendant: $109.00 plus (3) COPIES OF ALL SUPPORTING DOCUMENTS", 20, 50);
                doc.text("Two Defendants: $159.00 plus (5) COPIES OF ALL SUPPORTING DOCUMENTS", 20, 57);
                doc.text("Three Defendants: $209.00 plus (7) COPIES OF ALL SUPPORTING DOCUMENTS", 20, 64);
                doc.text("Each additional Defendant to be served: $50.00", 20, 71);
                doc.text("Re-Serve Fee: $50.00 per Defendant", 20, 78);
                
                doc.text("Please Note: The Plaintiff must provide copies of the lease or note,", 20, 90);
                doc.text("payment ledger, notices, and all other supporting documents.", 20, 95);
                
                doc.setFont("helvetica", "bold");
                doc.text("MILITARY AFFIDAVITS ARE REQUIRED ON ALL DEFENDANTS", 20, 105);
                
                // ===== PAGE 2: AFFIDAVIT FOR DISPOSSESSORY WARRANT =====
                doc.addPage();
                
                // Court Header
                doc.setFontSize(12);
                doc.setFont("helvetica", "bold");
                doc.text("IN THE MAGISTRATE COURT OF HOUSTON COUNTY, GEORGIA", 20, 20);
                doc.text(`Case No.: ${caseId}`, 150, 20);
                doc.text(`Date Filed: ${new Date().toLocaleDateString()}`, 150, 27);
                
                // Parties
                doc.text("PLAINTIFF(S):", 20, 40);
                doc.setFont("helvetica", "normal");
                doc.text(formData.landlord.name, 60, 40);
                const landlordAddressLine2 = formData.landlord.address2 ? `, ${formData.landlord.address2}` : '';
                doc.text(`${formData.landlord.address}${landlordAddressLine2}`, 60, 45);
                doc.text(`${formData.landlord.city}, ${formData.landlord.state} ${formData.landlord.zip}`, 60, 50);
                
                doc.setFont("helvetica", "bold");
                doc.text("VS.", 20, 60);
                
                doc.text("DEFENDANT(S):", 20, 70);
                doc.setFont("helvetica", "normal");
                doc.text(formData.tenant.name, 60, 70);
                doc.text(formData.property.address, 60, 75);
                doc.text(`${formData.property.city}, GA ${formData.property.zip}`, 60, 80);
                
                // Affidavit Title
                doc.setFontSize(14);
                doc.setFont("helvetica", "bold");
                doc.text("AFFIDAVIT FOR DISPOSSESSORY WARRANT", 20, 100);
                
                // Affidavit Content
                doc.setFontSize(11);
                doc.setFont("helvetica", "normal");
                doc.text("Personally appeared affiant, who on oath says:", 20, 110);
                
                // Paragraph 1
                doc.text("1. That Plaintiff herein, is the owner of premises situated and known as:", 20, 120);
                doc.text(`Apt./St. No.: ${formData.property.unit || 'N/A'}`, 40, 127);
                doc.text(`Address: ${formData.property.address}`, 40, 134);
                doc.text(`${formData.property.city}, Houston County, Georgia; and affiant is (X) the Plaintiff`, 40, 141);
                
                // Paragraph 2
                doc.text("2. That Defendant(s) herein, is/are in possession, as tenants, of the", 20, 155);
                doc.text("   subject premises, indicated above.", 20, 162);
                
                // Paragraph 3 - Tenancy Type
                doc.text("3. That Defendant's tenancy was", 20, 175);
                const leaseType = formData.case.leaseType;
                if (leaseType === 'fixed_term' || leaseType === 'month_to_month' || leaseType === 'week_to_week') {
                    doc.text("   ( ) at will ( ) at sufferance (X) under a written agreement.", 20, 182);
                } else if (leaseType === 'verbal') {
                    doc.text("   (X) at will ( ) at sufferance ( ) under a written agreement.", 20, 182);
                } else {
                    doc.text("   ( ) at will (X) at sufferance ( ) under a written agreement.", 20, 182);
                }
                
                // Paragraph 4 - Reason for Eviction
                doc.text("4. That", 20, 195);
                const reason = formData.case.reason;
                if (reason === 'non_payment') {
                    doc.text("   (X) tenant fails to pay rent now due thereon;", 20, 202);
                    doc.text("   ( ) tenant is holding said premises over and beyond the term;", 20, 209);
                    doc.text("   ( ) the term has been terminated by the Plaintiff, for the reason that", 20, 216);
                } else if (reason === 'holdover') {
                    doc.text("   ( ) tenant fails to pay rent now due thereon;", 20, 202);
                    doc.text("   (X) tenant is holding said premises over and beyond the term;", 20, 209);
                    doc.text("   ( ) the term has been terminated by the Plaintiff, for the reason that", 20, 216);
                } else {
                    doc.text("   ( ) tenant fails to pay rent now due thereon;", 20, 202);
                    doc.text("   ( ) tenant is holding said premises over and beyond the term;", 20, 209);
                    doc.text("   (X) the term has been terminated by the Plaintiff, for the reason that", 20, 216);
                    doc.text(`   ${reason}`, 40, 223);
                }
                
                // Paragraph 5
                doc.text("5. That Plaintiff desires possession of said premises; and, after", 20, 235);
                doc.text("   expiration, termination of default Plaintiff has demanded possession", 20, 242);
                doc.text("   of said premises and the same has been refused by said defendant(s);", 20, 249);
                
                // Continue on next page if needed
                if (pageHeight - 249 < 50) {
                    doc.addPage();
                    doc.text("   and, this affidavit is made that a warrant may issue for the removal", 20, 20);
                } else {
                    doc.text("   and, this affidavit is made that a warrant may issue for the removal", 20, 256);
                }
                
                let yPos = pageHeight - 249 < 50 ? 27 : 263;
                doc.text("   of said defendant(s) together with his property from said premises.", 20, yPos);
                
                // Paragraph 6 - Attorney Fees
                yPos += 15;
                doc.text("6. That attorney's fees are provided for in said lease, and pursuant", 20, yPos);
                yPos += 7;
                doc.text("   to O.C.G.A 13-1-11, Plaintiff has advised Defendant of Plaintiff's", 20, yPos);
                yPos += 7;
                doc.text("   intention to enforce this provision. Yes ( ) No (X)", 20, yPos);
                
                // Wherefore clause
                yPos += 20;
                doc.text("WHEREFORE, Plaintiff demands:", 20, yPos);
                yPos += 10;
                doc.text("(a) Possession of the premises;", 40, yPos);
                yPos += 10;
                doc.text(`(b) past due rent of $${formData.case.amountOwed.toFixed(2)};`, 40, yPos);
                yPos += 10;
                doc.text("(c) rent accruing up to the date of judgment or vacancy at the rate", 40, yPos);
                yPos += 7;
                doc.text(`   of $${(formData.case.rentAmount / 30).toFixed(2)} per day as computed from ${formData.case.lastPaymentDate || 'last payment date'};`, 40, yPos);
                yPos += 10;
                doc.text("(d) accrued interest at the rate of ______% from ____________;", 40, yPos);
                yPos += 10;
                doc.text("(e) attorney's fees in the amount of $__________;", 40, yPos);
                yPos += 10;
                doc.text("and, (f) $______ court cost.", 40, yPos);
                
                // Signature section
                yPos += 20;
                doc.text("AFFIANT", 20, yPos);
                yPos += 10;
                doc.line(20, yPos, 120, yPos);
                doc.text(`${formData.landlord.name}`, 20, yPos + 10);
                doc.text("Landlord", 20, yPos + 20);
                
                // Filed date
                doc.text(`Filed in office This ${new Date().getDate()} day of ${new Date().toLocaleString('default', { month: 'long' })}, ${new Date().getFullYear()}`, 20, yPos + 40);
                
                // Notary section
                yPos += 60;
                doc.text("Sworn to and subscribed before me", 20, yPos);
                yPos += 10;
                doc.text(`This ${new Date().getDate()} day of ${new Date().toLocaleString('default', { month: 'long' })}, ${new Date().getFullYear()}`, 20, yPos);
                yPos += 20;
                doc.line(20, yPos, 120, yPos);
                doc.text("(DEPUTY) Clerk, Magistrate Court of Houston County or Notary Public", 20, yPos + 10);
                
                // Add signature if available
                if (signatureData && signatureData.dataUrl) {
                    try {
                        const signatureImg = new Image();
                        signatureImg.src = signatureData.dataUrl;
                        doc.addImage(signatureImg, 'PNG', 20, yPos - 25, 50, 20);
                    } catch(e) {
                        console.log("Could not add signature to PDF");
                    }
                }
                
                // ===== PAGE 3: NOTICE AND SUMMONS =====
                doc.addPage();
                
                doc.setFontSize(14);
                doc.setFont("helvetica", "bold");
                doc.text("NOTICE AND SUMMONS", 105, 30, { align: "center" });
                
                doc.setFontSize(11);
                doc.setFont("helvetica", "normal");
                doc.text("TO THE ABOVE-NAMED DEFENDANT(s):", 20, 50);
                
                const summonsText = [
                    "You are hereby commanded and required, either personally or by attorney, to appear",
                    "and present an answer to the affidavit, on the reverse side hereof, during the regular",
                    "business hours, Monday through Friday, at the Magistrate Court of Houston County,",
                    "89 Cohen Walker Drive, Warner Robins (31088) on or before the SEVENTH (7th) day",
                    "from the date of service of this summons upon you (or on the first business day",
                    "thereafter IF the seventh day falls on a Saturday, Sunday, or Legal Holiday).",
                    "",
                    "Your answer may be given either orally or in writing; and may contain any legal or",
                    "equitable defenses or counterclaim against the plaintiff. The SEVENTH (7th) day after",
                    "the date of service of this summons is the last possible date for your answer.",
                    "",
                    "If you fail to answer as required, a Writ of Possession and judgment for the amount",
                    "claimed due by plaintiff will be granted without further notice to you."
                ];
                
                let textY = 70;
                summonsText.forEach(line => {
                    doc.text(line, 20, textY);
                    textY += 7;
                });
                
                doc.text("WITNESS THE HONORABLE JUDGES, MAGISTRATE COURT OF HOUSTON COUNTY, GEORGIA", 20, textY + 10);
                doc.text(`This ${new Date().getDate()} day of ${new Date().toLocaleString('default', { month: 'long' })}, ${new Date().getFullYear()}`, 20, textY + 25);
                doc.line(20, textY + 30, 120, textY + 30);
                doc.text("(DEPUTY) Clerk of Court", 20, textY + 40);
                
                // ===== PAGE 4: DISPOSSESSORY APPLICATION =====
                doc.addPage();
                
                doc.setFontSize(12);
                doc.setFont("helvetica", "bold");
                doc.text("DISPOSESSORY APPLICATION", 20, 20);
                
                // Application Form Fields
                doc.setFont("helvetica", "normal");
                let appY = 40;
                doc.text(`1. Plaintiff (Landlord): ${formData.landlord.name}`, 20, appY);
                appY += 10;
                doc.text(`2. Legal name of titleholder: ${formData.landlord.name}`, 20, appY);
                appY += 10;
                doc.text(`3. Applicant: ${formData.landlord.name}`, 20, appY);
                appY += 10;
                doc.text("4. Is an interpreter needed in this case? If so, provide the language(s) required.", 20, appY);
                appY += 10;
                doc.text("   _________________________________________________________", 20, appY);
                appY += 15;
                
                doc.text("5. Mailing address for Plaintiff:", 20, appY);
                appY += 7;
                doc.text(`   Street Address: ${formData.landlord.address}`, 20, appY);
                appY += 7;
                if (formData.landlord.address2) {
                    doc.text(`   ${formData.landlord.address2}`, 20, appY);
                    appY += 7;
                }
                doc.text(`   City: ${formData.landlord.city} State: ${formData.landlord.state} Zip: ${formData.landlord.zip}`, 20, appY);
                appY += 7;
                doc.text(`   Phone # for Plaintiff: ${formData.landlord.phone}`, 20, appY);
                appY += 7;
                doc.text(`   Email Address: ${formData.landlord.email}`, 20, appY);
                appY += 15;
                
                doc.text(`6. Name of Defendant(s) / Tenants(s): ${formData.tenant.name}`, 20, appY);
                appY += 15;
                
                doc.text("7. Leased Premises:", 20, appY);
                appY += 7;
                doc.text(`   Street Address: ${formData.property.address}`, 20, appY);
                appY += 7;
                doc.text(`   City: ${formData.property.city} State: GA Zip: ${formData.property.zip}`, 20, appY);
                appY += 7;
                doc.text(`   Phone # for Defendant(s): ${formData.tenant.phone || 'N/A'}`, 20, appY);
                appY += 15;
                
                // Type of Tenancy
                doc.text("8. Type of Tenancy:", 20, appY);
                const tenancyTypes = {
                    'written': 'Written Lease',
                    'at_will': 'At Will (Verbal)',
                    'at_sufferance': 'At Sufferance'
                };
                let tenancyType = 'at_will';
                if (formData.case.leaseType === 'fixed_term' || formData.case.leaseType === 'month_to_month' || formData.case.leaseType === 'week_to_week') {
                    tenancyType = 'written';
                } else if (formData.case.leaseType === 'verbal') {
                    tenancyType = 'at_will';
                } else {
                    tenancyType = 'at_sufferance';
                }
                
                appY += 7;
                doc.text(`   (${tenancyType === 'written' ? 'X' : ' '}) Written Lease`, 40, appY);
                doc.text(`   (${tenancyType === 'at_will' ? 'X' : ' '}) At Will (Verbal)`, 100, appY);
                doc.text(`   (${tenancyType === 'at_sufferance' ? 'X' : ' '}) At Sufferance`, 160, appY);
                appY += 15;
                
                // Reason for Eviction
                doc.text("9. Reason for Eviction:", 20, appY);
                const reasons = {
                    'non_payment': 'Failure to Pay Rent',
                    'holdover': 'Term Expired',
                    'lease_violation': 'Breach of Lease',
                    'other': 'Other'
                };
                let selectedReason = reasons[formData.case.reason] || 'Other';
                
                appY += 7;
                doc.text(`   (${selectedReason === 'Failure to Pay Rent' ? 'X' : ' '}) Failure to Pay Rent`, 40, appY);
                doc.text(`   (${selectedReason === 'Term Expired' ? 'X' : ' '}) Term Expired`, 100, appY);
                appY += 7;
                doc.text(`   (${selectedReason === 'Breach of Lease' ? 'X' : ' '}) Breach of Lease`, 40, appY);
                doc.text(`   (${selectedReason === 'Other' ? 'X' : ' '}) Other`, 100, appY);
                if (selectedReason === 'Other') {
                    appY += 7;
                    doc.text(`   Explain: ${formData.case.reason}`, 40, appY);
                }
                appY += 15;
                
                // Continue with remaining application fields...
                // [Additional application fields would continue here]
                
                // ===== PAGE 5: MILITARY AFFIDAVIT =====
                doc.addPage();
                doc.setFontSize(14);
                doc.setFont("helvetica", "bold");
                doc.text("MILITARY AFFIDAVIT", 105, 30, { align: "center" });
                
                doc.setFontSize(11);
                doc.setFont("helvetica", "normal");
                doc.text("The undersigned, after first being duly sworn, states the following:", 20, 50);
                
                doc.text(`1. I am of age, of sound mind, and legally authorized to sign this`, 20, 65);
                doc.text(`   affidavit on behalf of the Plaintiff.`, 20, 72);
                
                doc.text("2. This affidavit is executed pursuant to the Service Members Civil", 20, 85);
                doc.text("   Relief Act, 50 U.S.C. App. 521.", 20, 92);
                
                // Military status check
                doc.text("3. Affiant states the Defendant,", 20, 105);
                if (formData.tenant.militaryCheck) {
                    doc.text("   ( ) is, (X) is not, or ( ) unable to determine,", 20, 112);
                } else {
                    doc.text("   (X) is, ( ) is not, or ( ) unable to determine,", 20, 112);
                }
                doc.text("   a member of the military forces of the United States.", 20, 119);
                
                doc.text("4. Affiant is personally knowledgeable of the facts contained in", 20, 132);
                doc.text("   this affidavit and affirms the information contained herein is", 20, 139);
                doc.text("   true and correct.", 20, 146);
                
                // Signature section
                doc.text(`This ______ day of ${new Date().toLocaleString('default', { month: 'long' })}, ${new Date().getFullYear()}`, 20, 165);
                doc.line(20, 180, 120, 180);
                doc.text("Signature", 20, 187);
                doc.text(`Printed name: ${formData.landlord.name}`, 20, 194);
                doc.text("Title: Landlord", 20, 201);
                
                // Notary section
                doc.text("Sworn to and subscribed before me", 20, 215);
                doc.text(`this ______ day of ${new Date().toLocaleString('default', { month: 'long' })}, ${new Date().getFullYear()}`, 20, 225);
                doc.line(20, 235, 120, 235);
                doc.text("NOTARY PUBLIC", 20, 242);
                doc.text("www.dmdc.osd.mil/appj/scra", 20, 252);
                
                // Add signature if available
                if (signatureData && signatureData.dataUrl) {
                    try {
                        const signatureImg = new Image();
                        signatureImg.src = signatureData.dataUrl;
                        doc.addImage(signatureImg, 'PNG', 20, 175, 50, 20);
                    } catch(e) {
                        console.log("Could not add signature to PDF");
                    }
                }
                
                // ===== PAGE 6-7: INSTRUCTIONS =====
                doc.addPage();
                doc.text("89 Cohen Walker Drive  Warner Robins, Georgia 31088", 20, 20);
                doc.text("Phone (478) 987-4695  Fax (478) 987-5255", 20, 27);
                doc.text("Hours: 8:30 am - 4:30 pm", 20, 34);
                
                doc.setFont("helvetica", "bold");
                doc.text("INSTRUCTIONS FOR FILING A DISPOSSESSORY CASE", 20, 50);
                doc.text("IN THE MAGISTRATE COURT OF HOUSTON COUNTY", 20, 57);
                
                doc.setFont("helvetica", "normal");
                doc.setFontSize(10);
                const instructions = [
                    "Welcome to the Magistrate Court of Houston County. The information contained",
                    "herein is intended to provide you with general knowledge of the process for",
                    "filing a dispossessory case in the Magistrate Court. It is not a complete",
                    "disclosure of all legal action available to you. Therefore, you should carefully",
                    "research your options and understand the consequences of any action you",
                    "undertake. The clerks are available to assist you. However, they cannot advise",
                    "you how to handle your case, nor are they authorized to offer legal advice.",
                    "If you are unsure how to proceed with your case, please seek counsel from",
                    "an attorney.",
                    "",
                    "Definitions:",
                    "1. Tenancy at Will: Any rental agreement with no set date of termination.",
                    "2. Tenancy at Sufferance: Arises when one comes into possession of land by",
                    "   lawful right, whether as a tenant or otherwise, but wrongfully remains in",
                    "   possession of the property.",
                    "3. Leasehold Tenant: Is a tenant who has a written lease with all the necessary",
                    "   terms of a lease in the contract.",
                    "4. Tenant Holding Over: Is a tenant who holds possession of property beyond",
                    "   the term for which the premises were leased.",
                    "",
                    "General Provisions:",
                    "There are three common grounds for dispossession of a tenant:",
                    "1. The tenant's failure to pay rent when due",
                    "2. The tenant's holding over beyond the term of the lease or rental agreement; or",
                    "3. The landowner desires return of the property being held by a tenant at will",
                    "   or at sufferance."
                ];
                
                let instY = 80;
                instructions.forEach(line => {
                    if (instY > pageHeight - 20) {
                        doc.addPage();
                        instY = 20;
                    }
                    doc.text(line, 20, instY);
                    instY += line === "" ? 5 : 7;
                });
                
                return doc;
            }
            
            function generateDemandNotice() {
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                
                // Header
                doc.setFontSize(16);
                doc.setFont("helvetica", "bold");
                doc.text("STATE OF GEORGIA", pageWidth / 2, 20, { align: "center" });
                doc.text("COUNTY OF HOUSTON", pageWidth / 2, 30, { align: "center" });
                doc.text("7-DAY DEMAND FOR POSSESSION OF PREMISES", pageWidth / 2, 45, { align: "center" });
                
                doc.setFontSize(10);
                doc.setFont("helvetica", "normal");
                doc.text("(Pursuant to O.C.G.A.  44-7-50)", pageWidth / 2, 52, { align: "center" });
                
                // Tenant Information
                doc.setFontSize(12);
                doc.text(`TO: ${formData.tenant.name}`, 20, 70);
                doc.text(`PROPERTY ADDRESS: ${formData.property.address}, ${formData.property.city}, GA ${formData.property.zip}`, 20, 80);
                
                // Body Text
                doc.setFontSize(11);
                const bodyText = [
                    `You are hereby notified that you are in arrears in the payment of rent for the premises`,
                    `located at the above address in the amount of $${formData.case.amountOwed.toFixed(2)}.`,
                    "",
                    `Monthly rent for the premises is $${formData.case.rentAmount.toFixed(2)}. The rent became due`,
                    `on ${formData.case.lastPaymentDate || 'the due date'} and has not been paid.`,
                    "",
                    "You are further notified that unless said rent is paid in full within SEVEN (7) DAYS",
                    "from the date of service of this notice, your lease will be terminated and dispossessory",
                    "proceedings will be instituted against you.",
                    "",
                    "You are also liable for any court costs and attorney's fees incurred in this matter."
                ];
                
                let yPosition = 100;
                bodyText.forEach(line => {
                    if (yPosition > pageHeight - 40) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    doc.text(line, 20, yPosition);
                    yPosition += 7;
                });
                
                // Signature Section
                yPosition += 10;
                doc.text("Dated this _____ day of ____________________, 20____", 20, yPosition);
                
                yPosition += 20;
                doc.line(20, yPosition, 120, yPosition);
                doc.text(`${formData.landlord.name}`, 20, yPosition + 10);
                doc.text("Landlord/Agent", 20, yPosition + 20);
                
                // Footer
                doc.setFontSize(9);
                doc.setFont("helvetica", "italic");
                doc.text("This notice must be served at least 7 days before filing dispossessory proceedings.", 20, pageHeight - 20);
                doc.text("Service may be made by personal delivery, posting on the premises, or certified mail.", 20, pageHeight - 10);
                
                // Add signature if available
                if (signatureData && signatureData.dataUrl) {
                    try {
                        const signatureImg = new Image();
                        signatureImg.src = signatureData.dataUrl;
                        doc.addImage(signatureImg, 'PNG', 20, yPosition - 10, 50, 20);
                    } catch(e) {
                        console.log("Could not add signature to PDF");
                    }
                }
                
                return doc;
            }
            
            function generateAffidavit() {
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                
                // Header
                doc.setFontSize(14);
                doc.setFont("helvetica", "bold");
                doc.text("MAGISTRATE COURT OF HOUSTON COUNTY", pageWidth / 2, 20, { align: "center" });
                doc.text("STATE OF GEORGIA", pageWidth / 2, 30, { align: "center" });
                doc.text("DISPOSSESSORY AFFIDAVIT", pageWidth / 2, 45, { align: "center" });
                
                // Case Information
                doc.setFontSize(11);
                doc.setFont("helvetica", "normal");
                doc.text(`Plaintiff (Landlord): ${formData.landlord.name}`, 20, 70);
                doc.text(`Address: ${formData.landlord.address}, ${formData.landlord.city}, GA ${formData.landlord.zip}`, 20, 80);
                doc.text(`Phone: ${formData.landlord.phone}`, 20, 90);
                doc.text("", 20, 100);
                doc.text(`Defendant (Tenant): ${formData.tenant.name}`, 20, 110);
                doc.text(`Property Address: ${formData.property.address}, ${formData.property.city}, GA ${formData.property.zip}`, 20, 120);
                
                // Affidavit Text
                doc.setFontSize(11);
                const affidavitText = [
                    "STATE OF GEORGIA",
                    "COUNTY OF HOUSTON",
                    "",
                    `I, ${formData.landlord.name}, being duly sworn, depose and say:`,
                    "",
                    "1. I am the landlord/agent of the premises located at the above address.",
                    "",
                    `2. The tenant, ${formData.tenant.name}, is in possession of said premises.`,
                    "",
                    `3. The tenant is indebted to me in the amount of $${formData.case.amountOwed.toFixed(2)} for rent which`,
                    `   became due on ${formData.case.lastPaymentDate || 'the due date'} and has failed and refused to pay the same.`,
                    "",
                    `4. On ${formData.case.noticeDate}, I made a demand for possession of the premises,`,
                    "   and the tenant has failed to deliver possession.",
                    "",
                    "5. The tenant is not in the military service of the United States, to the best of my knowledge.",
                    "",
                    "WHEREFORE, affiant prays that a warrant issue directing the tenant to appear and answer",
                    "this complaint and that judgment be granted for possession of the premises, past due rent,",
                    "and costs of this action."
                ];
                
                let yPosition = 140;
                affidavitText.forEach(line => {
                    if (yPosition > 250) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    doc.text(line, 20, yPosition);
                    yPosition += 7;
                });
                
                // Signature Section
                yPosition += 10;
                doc.text("Sworn to and subscribed before me this _____ day of ____________________, 20____", 20, yPosition);
                
                yPosition += 20;
                doc.line(20, yPosition, 120, yPosition);
                doc.text("___________________________________________", 20, yPosition + 10);
                doc.text(`${formData.landlord.name}, Affiant`, 20, yPosition + 20);
                
                // Add signature if available
                if (signatureData && signatureData.dataUrl) {
                    try {
                        const signatureImg = new Image();
                        signatureImg.src = signatureData.dataUrl;
                        doc.addImage(signatureImg, 'PNG', 20, yPosition - 5, 50, 20);
                    } catch(e) {
                        console.log("Could not add signature to PDF");
                    }
                }
                
                return doc;
            }
            
            function generateSummons() {
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                
                // Header
                doc.setFontSize(16);
                doc.setFont("helvetica", "bold");
                doc.text("MAGISTRATE COURT OF HOUSTON COUNTY", pageWidth / 2, 20, { align: "center" });
                doc.text("STATE OF GEORGIA", pageWidth / 2, 30, { align: "center" });
                doc.text("SUMMONS", pageWidth / 2, 45, { align: "center" });
                doc.text("(DISPOSSESSORY PROCEEDINGS)", pageWidth / 2, 55, { align: "center" });
                
                // Case Number
                doc.setFontSize(12);
                doc.text(`Case No.: ${caseId}`, pageWidth - 40, 45);
                
                // Parties
                doc.setFontSize(12);
                doc.setFont("helvetica", "bold");
                doc.text("TO:", 20, 80);
                doc.setFont("helvetica", "normal");
                doc.text(`${formData.tenant.name}`, 40, 80);
                doc.text(`${formData.property.address}`, 40, 90);
                doc.text(`${formData.property.city}, GA ${formData.property.zip}`, 40, 100);
                
                // Body Text
                doc.setFontSize(11);
                const bodyText = [
                    "You are hereby summoned and required to file with the Clerk of this Court and serve upon",
                    `${formData.landlord.name}, whose address is ${formData.landlord.address},`,
                    "an answer to the complaint which is herewith served upon you, within SEVEN (7) DAYS after",
                    "service of this summons upon you, exclusive of the day of service.",
                    "",
                    "If you fail to do so, judgment by default will be taken against you for the relief demanded",
                    "in the complaint.",
                    "",
                    "This is an action to recover possession of the premises described above and for rent due",
                    `in the amount of $${formData.case.amountOwed.toFixed(2)}.`,
                    "",
                    "NOTICE: You have the right to a trial by jury. If you desire a jury trial, you must demand",
                    "it in your answer. If you do not demand a jury trial, the case will be heard by the judge."
                ];
                
                let yPosition = 130;
                bodyText.forEach(line => {
                    doc.text(line, 20, yPosition);
                    yPosition += 7;
                });
                
                // Clerk Signature
                yPosition += 20;
                doc.line(20, yPosition, 120, yPosition);
                doc.text("Clerk, Magistrate Court of Houston County", 20, yPosition + 10);
                
                return doc;
            }
            
            function generateSCRACertification() {
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                
                // Header
                doc.setFontSize(14);
                doc.setFont("helvetica", "bold");
                doc.text("VERIFICATION OF MILITARY SERVICE", pageWidth / 2, 20, { align: "center" });
                doc.text("(Servicemembers Civil Relief Act)", pageWidth / 2, 30, { align: "center" });
                doc.text("MAGISTRATE COURT OF HOUSTON COUNTY", pageWidth / 2, 40, { align: "center" });
                
                // Case Info
                doc.setFontSize(11);
                doc.setFont("helvetica", "normal");
                doc.text(`Case: ${formData.landlord.name} vs. ${formData.tenant.name}`, 20, 70);
                doc.text(`Property: ${formData.property.address}`, 20, 80);
                
                // Verification Text
                doc.setFontSize(11);
                const verificationText = [
                    `I, ${formData.landlord.name}, being duly sworn, depose and state:`,
                    "",
                    "1. I am the plaintiff/agent in the above-stated dispossessory action.",
                    "",
                    `2. The defendant, ${formData.tenant.name},`,
                    "",
                    `   ${formData.tenant.militaryCheck ? '' : ''} is NOT in the military service of the United States, to the best of my knowledge,`,
                    "     information, and belief.",
                    "",
                    `   ${formData.tenant.militaryCheck ? '' : ''} IS in the military service of the United States.`,
                    "     Branch: ____________________ Rank: ____________________",
                    "     Service Number: _______________",
                    "",
                    "3. The basis for this statement is:",
                    "    Personal knowledge",
                    "    Information from the defendant",
                    "    Information from a family member",
                    "    Other: ______________________________________________",
                    "",
                    "I understand that false statements on this form may result in dismissal of the",
                    "action and/or penalties under federal law."
                ];
                
                let yPosition = 100;
                verificationText.forEach(line => {
                    if (yPosition > 240) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    doc.text(line, 20, yPosition);
                    yPosition += 7;
                });
                
                // Signature Section
                yPosition += 10;
                doc.text("Sworn to and subscribed before me this _____ day of ____________________, 20____", 20, yPosition);
                
                yPosition += 20;
                doc.line(20, yPosition, 120, yPosition);
                doc.text("___________________________________________", 20, yPosition + 10);
                doc.text("Signature of Affiant", 20, yPosition + 20);
                
                // Add signature if available
                if (signatureData && signatureData.dataUrl) {
                    try {
                        const signatureImg = new Image();
                        signatureImg.src = signatureData.dataUrl;
                        doc.addImage(signatureImg, 'PNG', 20, yPosition - 5, 50, 20);
                    } catch(e) {
                        console.log("Could not add signature to PDF");
                    }
                }
                
                return doc;
            }
            
            // Setup Download Buttons
            function setupDownloadButtons() {
                // Individual document downloads
                document.querySelectorAll('.download-doc').forEach(button => {
                    button.addEventListener('click', function() {
                        const docType = this.getAttribute('data-doc');
                        downloadDocument(docType);
                    });
                });
                
                // Download all as ZIP
                document.getElementById('downloadAllBtn').addEventListener('click', downloadAllDocuments);
                
                // Start new filing
                document.getElementById('startNewBtn').addEventListener('click', function() {
                    evictionForm.style.display = 'none';
                    resetForm();
                    setTimeout(() => {
                        evictionForm.style.display = 'block';
                        goToStep(1);
                    }, 100);
                });
                
                // Open dashboard button
                document.getElementById('openDashboardBtn').addEventListener('click', function() {
                    window.open('dashboard/index.html', '_blank');
                });
            }
            
            // Download individual document
            function downloadDocument(docType) {
                const doc = generatedDocuments[docType];
                if (doc) {
                    const filename = getFilename(docType);
                    doc.save(filename);
                }
            }
            
            // Download all documents as ZIP
            function downloadAllDocuments() {
                showLoading('Creating document package...');
                
                try {
                    const zip = new JSZip();
                    const caseFolder = zip.folder(caseId);
                    
                    // Add each document to the ZIP
                    Object.keys(generatedDocuments).forEach(docType => {
                        const doc = generatedDocuments[docType];
                        const filename = getFilename(docType);
                        const pdfOutput = doc.output('blob');
                        caseFolder.file(filename, pdfOutput);
                    });
                    
                    // Add form data as JSON
                    const formDataJson = JSON.stringify(formData, null, 2);
                    caseFolder.file('case_data.json', formDataJson);
                    
                    // Add photo if available
                    if (noticePhotoData) {
                        const base64Data = noticePhotoData.replace(/^data:image\/(png|jpg|jpeg);base64,/, "");
                        caseFolder.file('notice_photo.jpg', base64Data, {base64: true});
                    }
                    
                    // Generate and download ZIP
                    zip.generateAsync({type: 'blob'})
                        .then(function(content) {
                            saveAs(content, `${caseId}_eviction_documents.zip`);
                            hideLoading();
                        })
                        .catch(function(error) {
                            console.error('Error creating ZIP:', error);
                            hideLoading();
                            alert('Error creating document package. Please try downloading documents individually.');
                        });
                    
                } catch (error) {
                    console.error('Error:', error);
                    hideLoading();
                    alert('Error creating document package. Please try downloading documents individually.');
                }
            }
            
            // Get filename for document type
            function getFilename(docType) {
                const filenames = {
                    houston_package: 'Houston_County_Dispossessory_Package.pdf',
                    demand_notice: '7-Day_Demand_Notice.pdf',
                    affidavit: 'Dispossessory_Affidavit.pdf',
                    summons: 'Summons.pdf',
                    scra_form: 'SCRA_Verification.pdf'
                };
                return filenames[docType] || 'document.pdf';
            }

            // === AUTO UPLOAD TO GITHUB ===
            async function uploadCaseToGitHub() {
                // Validate token before attempting upload
                const validation = validateGitHubToken(githubToken);
                
                if (!githubEnabled) {
                    console.log('GitHub backup disabled');
                    showNoBackupMessage();
                    return;
                }
                
                if (!validation.valid) {
                    console.log('Invalid GitHub token');
                    showTokenError(validation.error);
                    return;
                }

                showLoading('Saving case to GitHub repository...');
                
                try {
                    // First, verify token still works
                    await verifyGitHubAccess();
                    
                    // Then save to the centralized case_data.json file
                    await saveToMasterCaseFile();
                    
                    // Create individual case folder
                    const folder = `${GITHUB.basePath}${caseId}/`;
                    
                    // Save case.json to individual folder
                    const jsonContent = JSON.stringify({
                        ...formData,
                        caseId,
                        timestamp: new Date().toISOString(),
                        status: 'Pending Court Filing',
                        version: '2.1'
                    }, null, 2);

                    await uploadToGitHub(folder + 'case.json', 
                        btoa(unescape(encodeURIComponent(jsonContent))), 
                        `Add case ${caseId}`
                    );

                    // Save PDFs (optional - can skip if fails)
                    try {
                        await uploadPDFs(folder);
                    } catch (pdfError) {
                        console.warn('Some PDFs failed to upload:', pdfError);
                        // Continue anyway - JSON is the most important
                    }

                    hideLoading();
                    showUploadSuccess();
                    
                } catch (err) {
                    hideLoading();
                    console.error('GitHub upload failed:', err);
                    showUploadError(err);
                }
            }

            // === VERIFY GITHUB ACCESS ===
            async function verifyGitHubAccess() {
                const headers = {
                    'Accept': 'application/vnd.github.v3+json',
                    'Authorization': `Bearer ${githubToken}`,
                    'User-Agent': 'EvictionSystem/2.1'
                };
                
                try {
                    // Verify repo exists and we have write access
                    const repoResponse = await axios.get(
                        `https://api.github.com/repos/${GITHUB.owner}/${GITHUB.repo}`,
                        { headers, timeout: 10000 }
                    );
                    
                    if (!repoResponse.data.permissions || !repoResponse.data.permissions.push) {
                        throw new Error('Token does not have write permissions to repository');
                    }
                    
                    return true;
                } catch (error) {
                    if (error.response?.status === 401) {
                        throw new Error('Invalid GitHub token (401 Unauthorized). Please check your token.');
                    } else if (error.response?.status === 403) {
                        throw new Error('Token lacks write permissions to repository. Needs "repo" scope.');
                    } else if (error.response?.status === 404) {
                        throw new Error(`Repository not found: ${GITHUB.owner}/${GITHUB.repo}. Please create it first.`);
                    } else {
                        throw error;
                    }
                }
            }

            // === UPLOAD PDFs ===
            async function uploadPDFs(folder) {
                const pdfs = [
                    {key: 'houston_package', filename: 'Houston_County_Dispossessory_Package.pdf'},
                    {key: 'demand_notice', filename: 'Demand_Notice.pdf'},
                    {key: 'affidavit',     filename: 'Dispossessory_Affidavit.pdf'},
                    {key: 'summons',       filename: 'Summons.pdf'},
                    {key: 'scra_form',     filename: 'SCRA_Verification.pdf'}
                ];

                for (const pdf of pdfs) {
                    if (generatedDocuments[pdf.key]) {
                        try {
                            const pdfOutput = generatedDocuments[pdf.key].output('datauristring');
                            if (pdfOutput) {
                                const base64 = pdfOutput.split(',')[1];
                                await uploadToGitHub(folder + pdf.filename, base64, 
                                    `Add ${pdf.filename} for ${caseId}`, true);
                            }
                        } catch (pdfError) {
                            console.warn(`Failed to upload ${pdf.filename}:`, pdfError);
                            // Skip this PDF but continue with others
                        }
                    }
                }
            }

            // === SAVE TO MASTER CASE FILE ===
            async function saveToMasterCaseFile() {
                // First, get the existing case_data.json
                const masterFileUrl = `https://api.github.com/repos/${GITHUB.owner}/${GITHUB.repo}/contents/${GITHUB.basePath}case_data.json`;
                
                try {
                    const headers = {
                        'Accept': 'application/vnd.github.v3+json',
                        'Authorization': `Bearer ${githubToken}`,
                        'User-Agent': 'EvictionSystem/2.1'
                    };
                    
                    // Try to get existing file
                    let existingData = [];
                    let sha = null;
                    try {
                        const response = await axios.get(masterFileUrl, { headers });
                        const content = atob(response.data.content);
                        existingData = JSON.parse(content);
                        sha = response.data.sha;
                        if (!Array.isArray(existingData)) {
                            existingData = [];
                        }
                    } catch (error) {
                        // If file doesn't exist, start with empty array
                        if (error.response?.status !== 404) {
                            throw error;
                        }
                    }
                    
                    // Add new case to array
                    const caseEntry = {
                        caseId: caseId,
                        status: 'Pending Court Filing',
                        filingDate: new Date().toISOString(),
                        landlord: formData.landlord,
                        tenant: formData.tenant,
                        property: formData.property,
                        notice: formData.notice,
                        case: formData.case,
                        signature: formData.signature,
                        timestamp: new Date().toISOString(),
                        documentsGenerated: true,
                        version: '2.1'
                    };
                    
                    // Remove any existing entry with same caseId
                    existingData = existingData.filter(item => item.caseId !== caseId);
                    
                    // Add new entry at the beginning
                    existingData.unshift(caseEntry);
                    
                    // Convert to JSON
                    const jsonContent = JSON.stringify(existingData, null, 2);
                    const encodedContent = btoa(unescape(encodeURIComponent(jsonContent)));
                    
                    // Prepare update payload
                    const payload = {
                        message: `Add case ${caseId} to case_data.json`,
                        content: encodedContent,
                        branch: GITHUB.branch
                    };
                    
                    // Add SHA if file exists
                    if (sha) {
                        payload.sha = sha;
                    }
                    
                    // Upload updated file
                    await axios.put(masterFileUrl, payload, { headers });
                    
                    console.log('Updated master case_data.json with new case:', caseId);
                    
                } catch (error) {
                    console.error('Error updating master case file:', error);
                    if (error.response?.status === 401) {
                        throw new Error('Invalid GitHub token (401). Please check your token.');
                    } else {
                        throw new Error(`Failed to update case_data.json: ${error.message}`);
                    }
                }
            }

            // === UPLOAD TO GITHUB ===
            async function uploadToGitHub(path, content, message, isBase64 = false) {
                const url = `https://api.github.com/repos/${GITHUB.owner}/${GITHUB.repo}/contents/${path}`;
                
                const payload = {
                    message: message,
                    content: content,
                    branch: GITHUB.branch
                };

                const headers = {
                    'Accept': 'application/vnd.github.v3+json',
                    'Authorization': `Bearer ${githubToken}`,
                    'User-Agent': 'EvictionSystem/2.1',
                    'Content-Type': 'application/json'
                };

                try {
                    // Try to get existing file to get SHA
                    try {
                        const response = await axios.get(url, { headers });
                        payload.sha = response.data.sha;
                    } catch (error) {
                        // File doesn't exist yet, that's fine
                        if (error.response?.status !== 404) {
                            throw error;
                        }
                    }
                    
                    // Upload the file
                    const response = await axios.put(url, payload, { headers, timeout: 15000 });
                    console.log(`Uploaded to GitHub: ${path}`, response.status);
                    return response.data;
                    
                } catch (err) {
                    console.error(`GitHub upload failed for ${path}:`, err.response?.status, err.message);
                    
                    if (err.response?.status === 401) {
                        throw new Error('Invalid GitHub token. Please update your token.');
                    } else if (err.response?.status === 403) {
                        throw new Error('Rate limit exceeded or insufficient permissions.');
                    } else if (err.response?.status === 404) {
                        throw new Error('Repository or path not found.');
                    } else {
                        throw err;
                    }
                }
            }

            // === SUCCESS/ERROR MESSAGES ===
            function showUploadSuccess() {
                successMessage.innerHTML = `
                    <i class="fas fa-check-circle" style="color: #28a745;"></i>
                    <h3 style="color: #28a745;">Case Successfully Saved to GitHub!</h3>
                    <p>Your eviction case has been saved to GitHub and documents are ready for download.</p>
                    <p><strong>Case ID:</strong> ${caseId}</p>
                    <p><strong>Status:</strong> Pending Court Filing</p>
                    <p><strong>Repository:</strong> <a href="https://github.com/${GITHUB.owner}/${GITHUB.repo}/tree/main/${GITHUB.basePath}${caseId}" target="_blank">cases/${caseId}/</a></p>
                `;
                
                // Show success box
                const resultDiv = document.getElementById('githubResultMessage');
                resultDiv.innerHTML = `
                    <div class="info-box success">
                        <h4><i class="fas fa-check-circle"></i> GitHub Upload Successful</h4>
                        <p><strong>Case ID:</strong> ${caseId}</p>
                        <p><strong>View on GitHub:</strong> <a href="https://github.com/${GITHUB.owner}/${GITHUB.repo}/tree/main/${GITHUB.basePath}${caseId}" target="_blank">${GITHUB.basePath}${caseId}/</a></p>
                        <p><strong>Master file:</strong> <a href="https://github.com/${GITHUB.owner}/${GITHUB.repo}/blob/main/${GITHUB.basePath}case_data.json" target="_blank">case_data.json</a></p>
                        <p><em>Your dashboard will automatically show this case</em></p>
                    </div>
                `;
                resultDiv.style.display = 'block';
                
                document.getElementById('openDashboardBtn').style.display = 'inline-block';
            }

            function showUploadError(err) {
                successMessage.innerHTML = `
                    <i class="fas fa-exclamation-triangle" style="color: #dc3545;"></i>
                    <h3 style="color: #dc3545;">GitHub Upload Failed</h3>
                    <p>Your documents were generated but could not be saved to GitHub.</p>
                    <p><strong>Case ID:</strong> ${caseId}</p>
                    <p><strong>Error:</strong> ${err.message || 'Unknown error'}</p>
                    <p style="margin-top: 10px; font-size: 0.9em;">You can still download documents locally.</p>
                `;
                
                const resultDiv = document.getElementById('githubResultMessage');
                resultDiv.innerHTML = `
                    <div class="info-box warning">
                        <h4><i class="fas fa-exclamation-triangle"></i> GitHub Upload Failed</h4>
                        <p><strong>Error:</strong> ${err.message || 'Unknown error'}</p>
                        <p><strong>Solution:</strong></p>
                        <ol style="margin: 10px 0 0 20px;">
                            <li>Check your GitHub token at the top of the form</li>
                            <li>Make sure repository <code>${GITHUB.owner}/${GITHUB.repo}</code> exists</li>
                            <li>Token needs <strong>repo</strong> scope (full repository access)</li>
                            <li>Try generating a new token at: <a href="https://github.com/settings/tokens" target="_blank">github.com/settings/tokens</a></li>
                        </ol>
                    </div>
                `;
                resultDiv.style.display = 'block';
            }

            function showNoBackupMessage() {
                successMessage.innerHTML = `
                    <i class="fas fa-check-circle" style="color: #28a745;"></i>
                    <h3 style="color: #28a745;">Documents Generated Successfully!</h3>
                    <p>Your eviction documents have been generated.</p>
                    <p><strong>Case ID:</strong> ${caseId}</p>
                    <p><strong>Note:</strong> GitHub backup is disabled. Enable it at the top of the form to save to repository.</p>
                `;
            }

            function showTokenError(error) {
                successMessage.innerHTML = `
                    <i class="fas fa-exclamation-triangle" style="color: #dc3545;"></i>
                    <h3 style="color: #dc3545;">Invalid GitHub Token</h3>
                    <p>${error}</p>
                    <p><strong>Case ID:</strong> ${caseId}</p>
                    <p>Please enter a valid GitHub token at the top of the form.</p>
                `;
            }
            
            // Signature Pad Functions
            function initializeSignaturePad() {
                const canvas = document.getElementById('signaturePad');
                const ctx = canvas.getContext('2d');
                let drawing = false;
                
                // Set canvas size
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
                
                // Draw border
                ctx.strokeStyle = '#ccc';
                ctx.lineWidth = 2;
                ctx.strokeRect(0, 0, canvas.width, canvas.height);
                
                // Drawing functions
                function startDrawing(e) {
                    drawing = true;
                    draw(e);
                }
                
                function stopDrawing() {
                    drawing = false;
                    ctx.beginPath();
                    updateSignatureStatus();
                }
                
                function draw(e) {
                    if (!drawing) return;
                    
                    ctx.lineWidth = 2;
                    ctx.lineCap = 'round';
                    ctx.strokeStyle = '#000';
                    
                    ctx.lineTo(
                        e.clientX - canvas.getBoundingClientRect().left,
                        e.clientY - canvas.getBoundingClientRect().top
                    );
                    ctx.stroke();
                    ctx.beginPath();
                    ctx.moveTo(
                        e.clientX - canvas.getBoundingClientRect().left,
                        e.clientY - canvas.getBoundingClientRect().top
                    );
                }
                
                // Event listeners
                canvas.addEventListener('mousedown', startDrawing);
                canvas.addEventListener('mouseup', stopDrawing);
                canvas.addEventListener('mousemove', draw);
                
                canvas.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    const touch = e.touches[0];
                    startDrawing(touch);
                });
                
                canvas.addEventListener('touchend', stopDrawing);
                
                canvas.addEventListener('touchmove', function(e) {
                    e.preventDefault();
                    const touch = e.touches[0];
                    draw(touch);
                });
                
                // Clear signature button
                document.getElementById('clearSignature').addEventListener('click', function() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.strokeRect(0, 0, canvas.width, canvas.height);
                    document.getElementById('signaturePreview').style.display = 'none';
                    document.getElementById('nextStep6').disabled = true;
                    signatureData = null;
                    updateSignatureStatus();
                });
                
                // Type signature button
                document.getElementById('typeSignature').addEventListener('click', function() {
                    const typedName = prompt('Enter your signature text:', document.getElementById('signerName').value);
                    if (typedName) {
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        ctx.font = '40px cursive';
                        ctx.fillStyle = '#000';
                        ctx.textAlign = 'center';
                        ctx.fillText(typedName, canvas.width/2, canvas.height/2 + 15);
                        saveSignatureData();
                    }
                });
                
                // Save signature button
                document.getElementById('saveSignature').addEventListener('click', saveSignatureData);
                
                // Legal certification checkbox
                document.getElementById('legalCertify').addEventListener('change', function() {
                    const signBtn = document.getElementById('nextStep6');
                    signBtn.disabled = !(this.checked && signatureData);
                });
            }
            
            function saveSignatureData() {
                const canvas = document.getElementById('signaturePad');
                const signerName = document.getElementById('signerName').value;
                
                if (!signerName.trim()) {
                    alert('Please enter your name before saving signature.');
                    return;
                }
                
                // Check if signature is not empty
                const ctx = canvas.getContext('2d');
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                let isEmpty = true;
                
                for (let i = 3; i < imageData.data.length; i += 4) {
                    if (imageData.data[i] > 0) {
                        isEmpty = false;
                        break;
                    }
                }
                
                if (isEmpty) {
                    alert('Please draw or type your signature before saving.');
                    return;
                }
                
                // Save signature data
                signatureData = {
                    name: signerName,
                    dataUrl: canvas.toDataURL(),
                    timestamp: new Date().toISOString()
                };
                
                // Show preview
                const preview = document.getElementById('signaturePreview');
                const previewImg = document.getElementById('signatureImage');
                previewImg.src = signatureData.dataUrl;
                preview.style.display = 'flex';
                
                // Enable next button if legal certification is checked
                const signBtn = document.getElementById('nextStep6');
                const legalCertify = document.getElementById('legalCertify');
                signBtn.disabled = !legalCertify.checked;
                
                updateSignatureStatus('Signed and saved');
            }
            
            function updateSignatureStatus(status = 'Ready to sign') {
                const statusEl = document.getElementById('signatureStatus');
                if (status === 'Signed and saved') {
                    statusEl.innerHTML = '<i class="fas fa-check-circle" style="color: #28a745;"></i> ' + status;
                } else {
                    statusEl.innerHTML = '<i class="fas fa-pen"></i> ' + status;
                }
            }
            
            // Utility Functions
            function showLoading(message = 'Processing...') {
                loadingText.textContent = message;
                loadingOverlay.style.display = 'flex';
            }
            
            function hideLoading() {
                loadingOverlay.style.display = 'none';
            }
            
            function resetForm() {
                // Reset to step 1
                currentStep = 1;
                
                // Hide all steps except first
                const steps = document.querySelectorAll('.form-step');
                steps.forEach(step => step.classList.remove('active'));
                document.getElementById('step1').classList.add('active');
                
                // Reset progress indicators
                const circles = document.querySelectorAll('.step-circle');
                circles.forEach(circle => {
                    circle.classList.remove('active', 'completed');
                });
                document.getElementById('step1Circle').classList.add('active');
                
                // Clear form fields
                const form = document.getElementById('evictionForm');
                const inputs = form.querySelectorAll('input, select, textarea');
                inputs.forEach(input => {
                    if (input.type === 'checkbox') {
                        input.checked = false;
                    } else if (input.type === 'password') {
                        // Don't clear token field
                        if (input.id !== 'githubToken') {
                            input.value = '';
                        }
                    } else if (input.type === 'file') {
                        input.value = '';
                    } else if (input.type !== 'button' && input.type !== 'submit') {
                        input.value = '';
                    }
                });
                
                // Clear photo preview
                document.getElementById('previewImage').src = '';
                document.getElementById('photoPreview').style.display = 'none';
                noticePhotoData = null;
                
                // Reset signature
                document.getElementById('legalCertify').checked = false;
                document.getElementById('nextStep6').disabled = true;
                signatureData = null;
                document.getElementById('signaturePreview').style.display = 'none';
                
                // Reset success message
                document.getElementById('successMessage').innerHTML = `
                    <i class="fas fa-sync-alt fa-spin"></i>
                    <h3>Generating Documents...</h3>
                    <p>Please wait while we create your documents and save to GitHub.</p>
                `;
                
                // Clear result message
                document.getElementById('githubResultMessage').innerHTML = '';
                document.getElementById('githubResultMessage').style.display = 'none';
                
                // Clear case ID
                caseId = null;
                formData = {};
                generatedDocuments = {};
                
                // Hide dashboard button
                document.getElementById('openDashboardBtn').style.display = 'none';
                
                // Reset validation text
                document.getElementById('zipValidation').textContent = '';
                document.getElementById('propertyZipValidation').textContent = '';
                
                // Set today's date for notice date
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('noticePostingDate').value = today;
                
                // Set notice expiry date (3 days from today)
                const noticeExpiry = new Date();
                noticeExpiry.setDate(noticeExpiry.getDate() + 3);
                document.getElementById('noticeDate').value = noticeExpiry.toISOString().split('T')[0];
                
                // Set max date for last payment
                document.getElementById('lastPaymentDate').max = today;
            }
            
            // Pre-fill dates
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('noticePostingDate').value = today;
            
            // Set notice expiry date (3 days from today)
            const noticeExpiry = new Date();
            noticeExpiry.setDate(noticeExpiry.getDate() + 3);
            document.getElementById('noticeDate').value = noticeExpiry.toISOString().split('T')[0];
            
            // Set max date for last payment
            document.getElementById('lastPaymentDate').max = today;
            
            // Form validation
            document.getElementById('nextStep6').addEventListener('click', function() {
                if (!signatureData) {
                    alert('Please save your signature before proceeding.');
                    return;
                }
                if (!document.getElementById('legalCertify').checked) {
                    alert('Please certify the legal information before proceeding.');
                    return;
                }
                goToStep(7);
            });
        });
    </script>
</body>
</html>
